<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to GHRmodel ‚Äì GHRtools</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../figures/bsc-logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-81db3bc9543b97ff6e1d188ef868d7e2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">GHRtools</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data4health" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">data4health</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data4health">    
        <li>
    <a class="dropdown-item" href="../../docs/data4health/data4health.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-clim4health" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">clim4health</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-clim4health">    
        <li>
    <a class="dropdown-item" href="../../docs/clim4health/clim4health.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ghrexplore" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">GHRexplore</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ghrexplore">    
        <li>
    <a class="dropdown-item" href="../../docs/GHRexplore/GHRexplore.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/GHRexplore/GHRexplore-index.html">
 <span class="dropdown-text">Reference</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/GHRexplore/GHRexplore-news.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Vignettes</li>
        <li>
    <a class="dropdown-item" href="../../docs/GHRexplore/GHRexplore-vignette.html">
 <span class="dropdown-text">Getting started</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ghrmodel" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">GHRmodel</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ghrmodel">    
        <li>
    <a class="dropdown-item" href="../../docs/GHRmodel/GHRmodel.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/GHRmodel/GHRmodel-index.html">
 <span class="dropdown-text">Reference</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/GHRmodel/GHRmodel-news.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Vignettes</li>
        <li>
    <a class="dropdown-item" href="../../docs/GHRmodel/GHRmodel_overview.html">
 <span class="dropdown-text">Getting started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/GHRmodel/GHRmodel_covariates.html">
 <span class="dropdown-text">Covariate structures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/GHRmodel/GHRmodel_DLNM.html">
 <span class="dropdown-text">DLNMs in GHRmodel</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ghrpredict" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">GHRpredict</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ghrpredict">    
        <li>
    <a class="dropdown-item" href="../../docs/GHRpredict/GHRpredict.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://www.bsc.es/discover-bsc/organisation/research-departments/global-health-resilience" target="_blank"> 
<span class="menu-text">About GHR</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a></li>
  <li><a href="#data-requirements" id="toc-data-requirements" class="nav-link" data-scroll-target="#data-requirements">Data requirements</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">Methodology</a></li>
  <li><a href="#ghrmodel-structure" id="toc-ghrmodel-structure" class="nav-link" data-scroll-target="#ghrmodel-structure">GHRmodel structure</a>
  <ul class="collapse">
  <li><a href="#model-development" id="toc-model-development" class="nav-link" data-scroll-target="#model-development">1. Model development</a></li>
  <li><a href="#model-fitting" id="toc-model-fitting" class="nav-link" data-scroll-target="#model-fitting">2. Model fitting</a></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">3. Model evaluation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#ghrmodel-workflow" id="toc-ghrmodel-workflow" class="nav-link" data-scroll-target="#ghrmodel-workflow">GHRmodel workflow</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">0. Data</a>
  <ul class="collapse">
  <li><a href="#dataset-description" id="toc-dataset-description" class="nav-link" data-scroll-target="#dataset-description">Dataset description</a></li>
  <li><a href="#data-pre-processing" id="toc-data-pre-processing" class="nav-link" data-scroll-target="#data-pre-processing">Data pre-processing</a></li>
  <li><a href="#spatial-data-and-graphs" id="toc-spatial-data-and-graphs" class="nav-link" data-scroll-target="#spatial-data-and-graphs">Spatial data and graphs</a></li>
  </ul></li>
  <li><a href="#model-development-1" id="toc-model-development-1" class="nav-link" data-scroll-target="#model-development-1">1. Model development</a>
  <ul class="collapse">
  <li><a href="#create-lagged-covariates" id="toc-create-lagged-covariates" class="nav-link" data-scroll-target="#create-lagged-covariates">Create lagged covariates</a></li>
  <li><a href="#write-covariates" id="toc-write-covariates" class="nav-link" data-scroll-target="#write-covariates">Write covariates</a></li>
  <li><a href="#write-formulas" id="toc-write-formulas" class="nav-link" data-scroll-target="#write-formulas">Write formulas</a></li>
  </ul></li>
  <li><a href="#model-fitting-1" id="toc-model-fitting-1" class="nav-link" data-scroll-target="#model-fitting-1">2. Model fitting</a></li>
  <li><a href="#model-evaluation-1" id="toc-model-evaluation-1" class="nav-link" data-scroll-target="#model-evaluation-1">3. Model evaluation</a>
  <ul class="collapse">
  <li><a href="#rank-models" id="toc-rank-models" class="nav-link" data-scroll-target="#rank-models">Rank models</a></li>
  <li><a href="#posterior-predictive-checks" id="toc-posterior-predictive-checks" class="nav-link" data-scroll-target="#posterior-predictive-checks">Posterior predictive checks</a></li>
  <li><a href="#goodness-of-fit-metrics" id="toc-goodness-of-fit-metrics" class="nav-link" data-scroll-target="#goodness-of-fit-metrics">Goodness-of-fit metrics</a></li>
  <li><a href="#fitted-vs.-observed" id="toc-fitted-vs.-observed" class="nav-link" data-scroll-target="#fitted-vs.-observed">Fitted vs.&nbsp;Observed</a></li>
  <li><a href="#covariate-effects" id="toc-covariate-effects" class="nav-link" data-scroll-target="#covariate-effects">Covariate effects</a></li>
  <li><a href="#evaluate-random-effects" id="toc-evaluate-random-effects" class="nav-link" data-scroll-target="#evaluate-random-effects">Evaluate random effects</a></li>
  </ul></li>
  <li><a href="#iterative-model-selection" id="toc-iterative-model-selection" class="nav-link" data-scroll-target="#iterative-model-selection">4. Iterative model selection</a>
  <ul class="collapse">
  <li><a href="#subset-models" id="toc-subset-models" class="nav-link" data-scroll-target="#subset-models">Subset models</a></li>
  <li><a href="#extract-covariates" id="toc-extract-covariates" class="nav-link" data-scroll-target="#extract-covariates">Extract covariates</a></li>
  <li><a href="#add-an-additional-covariate" id="toc-add-an-additional-covariate" class="nav-link" data-scroll-target="#add-an-additional-covariate">Add an additional covariate</a></li>
  <li><a href="#fit-new-models" id="toc-fit-new-models" class="nav-link" data-scroll-target="#fit-new-models">Fit new models</a></li>
  <li><a href="#combine-models" id="toc-combine-models" class="nav-link" data-scroll-target="#combine-models">Combine models</a></li>
  <li><a href="#evaluate-combined-models" id="toc-evaluate-combined-models" class="nav-link" data-scroll-target="#evaluate-combined-models">Evaluate combined models</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to GHRmodel</h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<img src="../../figures/GHRexplore/logo_IDExtremes.jpg" align="right" width="18%"> <span> <span> <img src="../../figures/GHRexplore/logo_BSC.png" align="right" width="16%"> 
<style>
div.csl-bib-body {
  font-size: 0.9em;         /* smaller font */
}
div.csl-entry {
  margin-bottom: 0.6em;     /* add space between references */
}
</style>
<section id="overview" class="level1">
<h1>Overview</h1>
<p>The <strong>GHRmodel</strong> package supports modeling health outcomes using Bayesian hierarchical spatio-temporal models with complex covariate effects (e.g., linear, non-linear, interactions, distributed lag linear and non-linear models) in the <a href="https://www.r-inla.org/home">R-INLA</a> framework. It is designed to help users identify key drivers and predictors of disease risk by enabling streamlined model exploration, comparison, and visualization of complex covariate effects.</p>
<p>The <strong>GHRmodel</strong> package is designed to work in tandem with other packages of the GHRtools suite: <strong>GHRexplore</strong>, which facilitates data exploration and visualization, and <strong>GHRpredict</strong>, which computes out-of-sample probabilistic predictions of models developed in <strong>GHRmodel</strong> and enables predictive performance evaluation. More information about the toolkit, with tutorials and published examples can be found at this <a href="https://bsc-es.github.io/GHRtools/">website</a>.</p>
<p>This vignette provides an overview of the <strong>GHRmodel</strong> package methodology, the core functions, and a simple example workflow using real data. More complex use-cases and examples are described in other vignettes (<em>GHRmodel_DLNM</em> regarding Distributed Lag Nonlinear Models in <strong>GHRmodel</strong> and <em>GHRmodel_covariates</em> describing Complex Covariate Structures in <strong>GHRmodel</strong>). Vignettes loaded in the package can be accessed in R by typing <code>vignette("vignettename")</code> (e.g., <code>vignette("GHRmodel_overview")</code>).</p>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>The latest version of the <strong>GHRmodel</strong> package is hosted on <a href="https://cran.r-project.org/">CRAN</a> and can by installed using the following commands:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install from CRAN</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"GHRmodel"</span>) </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the development version from Gitlab</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_git</span>(<span class="st">'https://earth.bsc.es/gitlab/ghr/ghrmodel.git'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you have downloaded the source package as a <code>.tar.gz</code> file (e.g., from a release), you can install it locally using by typing <code>install.packages("path_to_tar.gz_file/GHRmodel_0.1.0.tar.gz", repos = NULL, type = "source", build_vignettes = TRUE)</code>.</p>
<p>One key dependency of the <strong>GHRmodel</strong> package, the <a href="https://www.r-inla.org/home">R-INLA</a> package, is not hosted on CRAN and must be installed manually using:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"INLA"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">repos=</span><span class="fu">c</span>(<span class="fu">getOption</span>(<span class="st">"repos"</span>),  </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">INLA=</span><span class="st">"https://inla.r-inla-download.org/R/stable"</span>), <span class="at">dep=</span><span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Instructions on how to install R-INLA and troubleshooting suggestions can be found on the <a href="https://www.r-inla.org/download-install">R-INLA download and installation page</a>.</p>
</section>
<section id="data-requirements" class="level2">
<h2 class="anchored" data-anchor-id="data-requirements">Data requirements</h2>
<p>The data must be organized as a long-format data frame comprising a regularly spaced time series (e.g., daily, weekly, monthly) for a single or several spatial units. That is, each row must represent a single observation for a specific time and (optionally) a specific location. In this data frame, the time (e.g., <em>date</em>) and optional space identifiers (e.g., <em>region_name</em>) must be included as columns, as in the example below. The time identifier must be in <code>Date</code> format (<code>YYYY-MM-DD</code>).</p>
<pre><code>#&gt; # A tibble: 6 √ó 4
#&gt;   date       region_name  dengue_cases  tmin
#&gt;   &lt;date&gt;     &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 2001-01-01 Alto Taquari            0  22.3
#&gt; 2 2001-02-01 Alto Taquari            2  22.1
#&gt; 3 2001-03-01 Alto Taquari            6  21.7
#&gt; 4 2001-04-01 Alto Taquari           14  21.4
#&gt; 5 2001-05-01 Alto Taquari           24  17.0
#&gt; 6 2001-06-01 Alto Taquari            7  15.0</code></pre>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">Methodology</h2>
<p>The goal of the <strong>GHRmodel</strong> package is to streamline the development of climate-sensitive disease risk models into a generalizable and reproducible modeling workflow, which could then be integrated into decision-support systems (e.g., see (Fletcher et al., 2025; Lowe et al., 2018, 2021)). The package implements a Bayesian hierarchical modeling framework to estimate disease case counts, assuming a Poisson or negative binomial distribution. The basic model structure incorporates random effects to capture unexplained seasonal, interannual, and spatial variation, alongside covariates representing (lagged) climatic, environmental, or socioeconomic drivers.</p>
<p>There are conflicting definitions of what constitutes a fixed effect or random effect (Gelman &amp; Hill, 2006). In this vignette we will refer to:</p>
<ul>
<li><p><strong>fixed effects</strong> as covariates whose estimated effects on the outcome are of direct interest (e.g., include a fixed effect for mean temperature to measure the change in dengue incidence per each 1 ¬∞C increase, holding other factors constant).</p></li>
<li><p><strong>random effects</strong> as model components that capture unobserved heterogeneity, accounting for variation across groups, clusters, or units that is not explained by observed covariates (e.g., include a district-level random effect to capture residual differences in baseline dengue incidence that are not explained by other covariates in the model, such as different reporting strategies or unmeasured vector habitat characteristics).</p></li>
</ul>
<p>The basic model structure can be expressed as:</p>
<p><span class="math display">\[
y_{s,t} \sim \text{NegBin}(\mu_{s,t}, \theta)
\]</span></p>
<p><span class="math display">\[
log(\mu_{s,t}) = \alpha + \delta_m(t) + \gamma_a(t) + u_s + v_s + \sum_{k} \beta_k X_{k,t,s}
\]</span></p>
<p>Where:</p>
<ul>
<li><p><span class="math inline">\(y_{s,t}\)</span> is the observed number of cases at location <span class="math inline">\(s\)</span> and time <span class="math inline">\(t\)</span>.</p></li>
<li><p><span class="math inline">\(\theta\)</span> is the overdispersion parameter.</p></li>
<li><p><span class="math inline">\(\mu_{s,t}\)</span> is the expected value of the number of cases.</p></li>
<li><p><span class="math inline">\(\alpha\)</span> is the intercept</p></li>
<li><p><span class="math inline">\(\delta_m(t)\)</span> is the monthly random effect (seasonality)</p></li>
<li><p><span class="math inline">\(\gamma_a(t)\)</span> is the yearly random effect (interannual variation)</p></li>
<li><p><span class="math inline">\(u_s\)</span> is the structured spatial random effect for location <span class="math inline">\(s\)</span></p></li>
<li><p><span class="math inline">\(v_s\)</span> is the unstructured spatial random effect for location <span class="math inline">\(s\)</span></p></li>
<li><p><span class="math inline">\(\sum_{k} \beta_k X_{k,t}\)</span> is the sum over covariates (<span class="math inline">\(X_{k,t}\)</span>) and their coefficients (<span class="math inline">\(\beta_k\)</span>)</p></li>
</ul>
<p>This flexible structure serves as a foundation for more complex models incorporating interactions, non-linearities, and distributed lags.</p>
<p>Model estimation is performed using <a href="https://www.r-inla.org/home">R-INLA</a>, an R package that implements Bayesian inference using the Integrated Nested Laplace Approximation (INLA) method for latent Gaussian models (Lindgren et al., 2011; Rue et al., 2009). This approach offers substantial computational advantages compared to Markov Chain Monte Carlo (MCMC) inference methods, often yielding similar results with significantly reduced runtime (Rue et al., 2017). R-INLA also supports spatial and spatio-temporal modeling, making it well-suited for epidemiological applications.</p>
<p>To learn more about Bayesian inference, <a href="https://srcd.onlinelibrary.wiley.com/doi/10.1111/cdev.12169">this paper</a> provides an initial overview and this book (<a href="https://civil.colorado.edu/~balajir/CVEN6833/bayes-resources/RM-StatRethink-Bayes.pdf">Statistical Rethinking</a>) is a comprehensive and accessible introduction to the subject (McElreath, 2020; Van De Schoot et al., 2014). To learn more about Bayesian inference using R-INLA there is a wide array of freely accessible <a href="https://www.r-inla.org/learnmore">resources online</a>. Useful online <a href="https://www.r-inla.org/learnmore/books">books</a> include <a href="https://becarioprecario.bitbucket.io/inla-gitbook/">Bayesian Inference with INLA</a> or <a href="https://www.paulamoraga.com/book-geospatial/index.html">Geospatial Health Data: modeling and visualization with R-INLA and Shiny</a> (G√≥mez-Rubio, 2020; Moraga, 2019)</p>
</section>
<section id="ghrmodel-structure" class="level2">
<h2 class="anchored" data-anchor-id="ghrmodel-structure">GHRmodel structure</h2>
<div class="figure" style="text-align: center">
<img src="https://gitlab.earth.bsc.es/ghr/ghrmodel/-/raw/510e4737684359badce248d83a9113be8a3b976f/inst/images/GHRmodel_structure.png" alt="**GHRmodel** functions to streamline INLA-compatible model formula development." width="100%">
<p class="caption">
<strong>GHRmodel</strong> functions to streamline INLA-compatible model formula development.
</p>
</div>
<p><br> This vignette outlines the full modeling workflow using the <strong>GHRmodel</strong> package. The process is organized into three key stages: model development, model fitting, and model evaluation.</p>
<section id="model-development" class="level3">
<h3 class="anchored" data-anchor-id="model-development">1. Model development</h3>
<p>To fit a model with R-INLA, formulas need to follow its required syntax and structural conventions. INLA-compatible model formulas can be developed using either:</p>
<ul>
<li><p>User-defined INLA-compatible input, which may consist of either user-defined covariate lists or user-defined formula lists.</p></li>
<li><p><strong>GHRmodel</strong> helper functions that allow the user to pre-process and transform covariates and streamline writing INLA-compatible formulas.</p></li>
<li><p><strong>Pre-process covariates</strong>: The <code>lag_cov</code>, <code>onebasis_inla</code> and <code>crossbasis_inla</code> functions allow the user to create lagged covariates and one-or-two dimensional basis-transformed matrices, allowing the exploration of the effect of a covariate across the exposure and/or lag dimension.</p></li>
<li><p><strong>Write covariates</strong>: Functions with the prefix <code>*cov_</code> allow the user to generate lists of covariates to simplify building valid INLA formulas. These functions allow the user to include lagged, non-linear or more complex covariate structures:</p></li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Function</th>
<th style="text-align: left;">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>extract_names()</code></td>
<td style="text-align: left;">Selects covariate names from a dataset</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>cov_uni()</code></td>
<td style="text-align: left;">Prepares covariates for univariable INLA models</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>cov_nl()</code></td>
<td style="text-align: left;">Converts covariates to non-linear effect terms, with optional replication.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>cov_interact()</code></td>
<td style="text-align: left;">Creates interaction terms between 2 or 3 covariates (e.g., var1:var2).</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>cov_varying()</code></td>
<td style="text-align: left;">Creates spatially or temporally varying effect terms.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>cov_multi()</code></td>
<td style="text-align: left;">Generates combinations of covariates for multivariable models.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>cov_add()</code></td>
<td style="text-align: left;">Adds a covariate to each element of a covariate list.</td>
</tr>
</tbody>
</table>
<p>Overview of helper functions to prepare covariate lists for INLA model formulas.</p>
<ul>
<li><strong>Write formulas</strong>: The <code>write_inla_formulas()</code> function generates INLA-compatible model formulas with structured fixed effects, random effects, and interactions from a list of INLA-compatible covariate sets.</li>
</ul>
<p>Once the INLA-compatible model formulas are developed, they must be passed to the <code>as_GHRformulas()</code> function to be converted into a standardized <code>GHRformulas</code> object. This ensures consistent output structure and random effect specification across models that can be interpreted by the function <code>fit_models()</code> for model fitting. The <code>as_GHRformulas()</code> function accepts either a user-defined vector of formulas or the output from <code>write_inla_formulas()</code>. Currently all formulas in a <code>GHRformulas</code> object must share the same random-effect structure. For example, you cannot combine formulas that include both seasonal and annual random effects with formulas that include only seasonal random effects.</p>
<p>For more information see <code>vignette("GHRmodel_covariates")</code>.</p>
</section>
<section id="model-fitting" class="level3">
<h3 class="anchored" data-anchor-id="model-fitting">2. Model fitting</h3>
<p>The <code>fit_models()</code> function allows users to fit a set of INLA-compatible model formulas defined by a <code>GHRformulas</code> object to a provided data set. It automates model fitting, extraction of outputs, and computation of a wide range of goodness-of-fit (GoF) metrics. The output is a <code>GHRmodels</code> object.</p>
<p>Efficient modeling workflows often require organizing, comparing, and extracting subsets of models. The <code>GHRmodels</code> object supports these operations via helper functions to subset, stack, and retrieve covariates (<code>subset_models()</code>, <code>stack_models()</code>, <code>get_covariates()</code>, respectively).</p>
</section>
<section id="model-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="model-evaluation">3. Model evaluation</h3>
<p><strong>GHRmodel</strong> provides a range of functions for model diagnostics, interpretation and evaluation. Functions with the prefix <code>plot_*</code> return graphical <code>ggplot2</code> or <code>cowplot</code> objects, allowing users to easily customize visual outputs.</p>
<ul>
<li><p><strong>Model diagnostics</strong>: posterior predictive checks (<code>plot_ppd()</code>), assessment of GoF metrics (<code>rank_models()</code>, <code>plot_gof()</code>), visualization of fitted values vs.&nbsp;observed case counts (<code>plot_fit()</code>).</p></li>
<li><p><strong>Covariate effect visualizations</strong> (with the prefix <code>plot_coef_*</code>) including:</p></li>
<li><p>Linear effects (<code>plot_coef_lin()</code>)</p></li>
<li><p>Non-linear effects (<code>plot_coef_nl()</code>)</p></li>
<li><p>Group-varying effects (<code>plot_coef_varying()</code>)</p></li>
<li><p>Effects derived from one-basis or crossbasis matrices (<code>plot_coef_crosspred()</code>)</p></li>
<li><p><strong>Random effects visualizations</strong>: <code>plot_re()</code> can be used to assess spatial and temporal random effects.</p></li>
</ul>
<p>To access the documentation for each function with detailed descriptions and examples, type in R <code>? functionname</code> (e.g., <code>? plot_fit</code>).</p>
<p>Plot color palettes follow the same structure as those in the <strong>GHRexplore</strong> package, a dependency of <strong>GHRmodel</strong>. These include several in-house palettes, as well as palettes from <strong>RColorBrewer</strong> and <strong>colorspace</strong>. For details on palette usage, see <code>vignette("GHRexplore")</code>.</p>
<p><br> <br></p>
</section>
</section>
</section>
<section id="ghrmodel-workflow" class="level1">
<h1>GHRmodel workflow</h1>
<p>In this example, we demonstrate how to use <strong>GHRmodel</strong> to formulate, fit and evaluate univariable and bivariate models of dengue risk with <em>tmin</em> (monthly average daily minimum temperature averaged across each spatial unit) and <em>pdsi</em> (self-calibrated Palmer Drought Severity Index for each microregion) across 1- to 6-month lags.</p>
<blockquote class="blockquote">
<p>üìù <strong>Note</strong>: The examples in this vignette are designed to demonstrate package functionality and should not be interpreted as best-practice guidance for model selection.</p>
</blockquote>
<p>First, we load the required R libraries:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary package dependencies</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)        <span class="co"># Data manipulation</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)        <span class="co"># Data tidying</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyselect)   <span class="co"># Helpers for selecting variables programmatically</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)        <span class="co"># Tools for tidy evaluation and non-standard evaluation in tidyverse code</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)      <span class="co"># Data visualization: creating plots and graphs</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)      <span class="co"># Combining and arranging multiple ggplot2 plots into a single figure</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grDevices)    <span class="co"># Base R graphics device functions (e.g., color palettes, saving plots)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) <span class="co"># Predefined color palettes for plots</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorspace)   <span class="co"># Advanced color space manipulation and palettes</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)           <span class="co"># Handling spatial vector data (simple features)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)        <span class="co"># Spatial dependence and autocorrelation analysis</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sn)           <span class="co"># Skew-normal and skew-t distributions (for modeling skewed data)</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(INLA)         <span class="co"># Integrated Nested Laplace Approximation for Bayesian models</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GHRexplore)   <span class="co"># Exploratory analysis of health data</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Load GHRmodel</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GHRmodel)     </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">0. Data</h2>
<section id="dataset-description" class="level3">
<h3 class="anchored" data-anchor-id="dataset-description">Dataset description</h3>
<p>The example dataset contains monthly counts of notified dengue cases by microregion, along with a range of spatial and spatio-temporal covariates. This dataset represents a subset of a larger national dataset that covers the entire territory of Brazil. The subset focuses on a specific region, <em>Mato Grosso do Sul</em>, for the purposes of illustration and computational efficiency. The original full data set, which includes data from all Brazilian microregions, is cited in the accompanying <a href="https://github.com/drrachellowe/hydromet_dengue">source code on GitHub</a> and <a href="https://doi.org/10.5281/zenodo.4632205">Zenodo</a>.</p>
<p>In this data frame, the <em>date</em> column contains the temporal identifier (in this case, we have monthly data) and the spatial unit identifier is <em>micro_code</em>. Each <em>micro_code</em> corresponds to a distinct microregion with a complete monthly time series. For more information about the data set, see <code>?dengue_MS</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load data </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"dengue_MS"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> dengue_MS</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># View initial rows in example dataframe</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 √ó 27</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   micro_code micro_name     micro_name_ibge meso_code meso_name    state_code state_name region_code region_name biome_code biome_name</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;     </span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      50001 Baixo Pantanal BAIXO PANTANAL       5001 Pantanais S‚Ä¶         50 Mato Gros‚Ä¶           5 Centre-West          3 Pantanal  </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      50002 Aquidauana     AQUIDAUANA           5001 Pantanais S‚Ä¶         50 Mato Gros‚Ä¶           5 Centre-West          3 Pantanal  </span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      50003 Alto Taquari   ALTO TAQUARI         5002 Centro Nort‚Ä¶         50 Mato Gros‚Ä¶           5 Centre-West          2 Cerrado   </span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      50004 Campo Grande   CAMPO GRANDE         5002 Centro Nort‚Ä¶         50 Mato Gros‚Ä¶           5 Centre-West          2 Cerrado   </span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      50005 Cassil√¢ndia    CASSIL√ÇNDIA          5003 Leste De Ma‚Ä¶         50 Mato Gros‚Ä¶           5 Centre-West          2 Cerrado   </span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      50006 Parana√≠ba      PARANA√çBA            5003 Leste De Ma‚Ä¶         50 Mato Gros‚Ä¶           5 Centre-West          2 Cerrado   </span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ‚Ñπ 16 more variables: ecozone_code &lt;dbl&gt;, ecozone_name &lt;chr&gt;, main_climate &lt;chr&gt;, month &lt;dbl&gt;, year &lt;dbl&gt;, time &lt;dbl&gt;,</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   dengue_cases &lt;dbl&gt;, population &lt;dbl&gt;, pop_density &lt;dbl&gt;, tmax &lt;dbl&gt;, tmin &lt;dbl&gt;, pdsi &lt;dbl&gt;, urban &lt;dbl&gt;, water_network &lt;dbl&gt;,</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   water_shortage &lt;dbl&gt;, date &lt;date&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="data-pre-processing" class="level3">
<h3 class="anchored" data-anchor-id="data-pre-processing">Data pre-processing</h3>
<p>Create numeric ID variables for categorical features (such as year, month, or spatial units) that may be included as random effects, in line with R-INLA‚Äôs requirements. R-INLA expects random effect variables to be specified as numeric indices. Additionally, each variable can only appear in a single model term. Therefore, if a categorical variable is used in multiple roles (e.g., as a random effect and also as a grouping variable for a fixed effect), separate numeric ID variables must be created for each usage.</p>
<blockquote class="blockquote">
<p>üí° <strong>Tip</strong>: It is recommended to retain both the numeric ID and the original categorical variable in your dataset, as this supports easier interpretation and model evaluation, for example by allowing users to easily map model outputs based on numeric IDs back to the original labels for reporting or visualization.</p>
</blockquote>
<blockquote class="blockquote">
<p>üí° <strong>Tip</strong>: It is important to check that the time identifier is in <code>Date</code> format (<code>YYYY-MM-DD</code>). This is especially important if we want to use <strong>GHRmodel</strong> functions to lag covariates.</p>
</blockquote>
<p>Here we generate numeric IDs for year, month, the spatial unit at which the data is aggregated (in this case <em>micro_code</em>), and a larger aggregation unit (<em>meso_code</em>).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that the date variable is in Date format</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(df<span class="sc">$</span>date)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "Date"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create ID variables</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span>  </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out the year 2000. There are no dengue cases for that year. </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">2000</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create numeric IDs for year, month and various spatial units.</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_id =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(year)),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_id =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(month)),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">spat_id =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(micro_code)), </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">spat_meso_id =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(meso_code))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="spatial-data-and-graphs" class="level3">
<h3 class="anchored" data-anchor-id="spatial-data-and-graphs">Spatial data and graphs</h3>
<p>To perform spatial analysis and generate maps of observations across multiple spatial units, the polygon geometries must be provided as an <code>sf</code> object. Polygon geometries represent the shapes and boundaries of spatial units (e.g., districts, or ecological zones) using a series of connected coordinate points that enclose an area. The <code>sf</code> object must include a spatial unit identifier to enable linkage with the corresponding data frame. For the <code>dengue_MS</code> dataset, the areal polygons are already included in the package in the <code>map_MS</code> object. In <code>map_MS</code>, the <em>code</em> variable corresponds to the <em>micro_code</em> area identifier in the <code>dengue_MS</code> object.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load map (sf object) included in package</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"map_MS"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the map with microregion labels</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> map_MS) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> map_MS, <span class="fu">aes</span>(<span class="at">label =</span> code), <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mato Grosso do Sul"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Latitude"</span>)<span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/Load map_MS-1.png" style="display: block; margin: auto;"></p>
<p>To model spatially structured random effects (e.g., using the Besag-York-Molli√© model (BYM (Besag et al., 1991)) or BYM2 model (Simpson et al., 2017) for areal data in R-INLA), we need an adjacency matrix that defines neighboring relationships between spatial units. Spatially structured random effects (represented by <span class="math inline">\(u_s\)</span> in the example model formulation above) account for spatial autocorrelation (meaning that nearby regions tend to have similar values) by introducing a correlation structure based on geographic proximity. Spatially unstructured random effects (represented by <span class="math inline">\(v_s\)</span> in the example model formulation above) can be used to account for uncorrelated noise. Including these random effects helps capture spatial variation that is not explained by the fixed effects in the model.</p>
<p>The adjacency matrix, indicating which spatial units share borders, is constructed using the <strong>spdep</strong> package.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create adjacency Matrix</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">poly2nb</span>(map_MS)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nb2mat</span>(nb, <span class="at">style =</span> <span class="st">"B"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="model-development-1" class="level2">
<h2 class="anchored" data-anchor-id="model-development-1">1. Model development</h2>
<p>In this example we demonstrate how to use the <strong>GHRmodel</strong> helper functions to streamline writing INLA-compatible formulas.</p>
<section id="create-lagged-covariates" class="level3">
<h3 class="anchored" data-anchor-id="create-lagged-covariates">Create lagged covariates</h3>
<p><code>lag_cov()</code> creates lagged versions of numeric or categorical variables in an equally spaced time-series data set.</p>
<p>Here, we use it to generate lagged values for the variables <em>tmin</em> (monthly average daily minimum temperature averaged across each microregion) and <em>pdsi</em> (monthly Self-calibrated Palmer Drought Severity Index for each microregion) from 1- to 6-month lags using the <code>lag_cov()</code> function.</p>
<p>To use this function, the user must specify:</p>
<ul>
<li><p><code>name</code>: The name of the variable (or variables) to lag.</p></li>
<li><p><code>time</code>: The column representing the time variable.</p></li>
<li><p><code>lag</code>: a vector of integers (that is, list of numbers like <code>2</code> or <code>c(1,2)</code>) indicating how many time steps (e.g., months) the values should be shifted backward (for instance, a 1-month lag for <em>tmin</em> in February would correspond to the value of <em>tmin</em> in January).</p></li>
</ul>
<p>In this example, each <em>micro_code</em> represents a spatial unit with its own monthly time series. When the dataset contains multiple such time series (one for each group) the <code>group</code> argument should be specified to ensure that lags are computed independently within each group.</p>
<p>The <code>add</code> argument determines whether the lagged variables should be appended to the original dataset (<code>add = TRUE</code>) or returned as a separate matrix (<code>add = FALSE</code>).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">lag_cov</span>(<span class="at">data =</span> df,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"tmin"</span>, <span class="st">"pdsi"</span>),  <span class="co"># variables to lag </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">time =</span> <span class="st">"date"</span>,        <span class="co"># time variable </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">lag =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),         <span class="co"># 1 to 6-month lags</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> <span class="st">"micro_code"</span>, <span class="co"># identify spatial units with independent time series</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">add =</span> <span class="cn">TRUE</span>)           <span class="co"># lagged variables appended to original data</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize lagged variables</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data[<span class="dv">32</span><span class="sc">:</span><span class="dv">43</span>])</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 √ó 12</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   tmin.l1 tmin.l2 tmin.l3 tmin.l4 tmin.l5 tmin.l6  pdsi.l1 pdsi.l2 pdsi.l3 pdsi.l4 pdsi.l5 pdsi.l6</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    NA      NA      NA      NA      NA        NA NA       NA      NA      NA      NA           NA</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2    23.5    NA      NA      NA      NA        NA  0.0890  NA      NA      NA      NA           NA</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3    23.3    23.5    NA      NA      NA        NA  0.260    0.0890 NA      NA      NA           NA</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4    22.7    23.3    23.5    NA      NA        NA  0.266    0.260   0.0890 NA      NA           NA</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5    21.9    22.7    23.3    23.5    NA        NA  0.0654   0.266   0.260   0.0890 NA           NA</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6    17.8    21.9    22.7    23.3    23.5      NA -0.00682  0.0654  0.266   0.260   0.0890      NA</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<blockquote class="blockquote">
<p>üí° <strong>Tip</strong>: To avoid missing values introduced by lagged variables, consider including covariate data from months prior to your analysis start date. This helps ensure complete lag structures at the beginning of the time series. For instance if you disease case data records start in January 2010, and you intend to include covariates with up to a 3-month lag, you should include covariate data starting from October 2009 (3 months before the analysis start date).</p>
</blockquote>
</section>
<section id="write-covariates" class="level3">
<h3 class="anchored" data-anchor-id="write-covariates">Write covariates</h3>
<p>The <strong>GHRmodel</strong> package contains a set of functions to help users generate organized lists of covariates to be included in the models, simplifying the process of building INLA-compatible formulas. In this vignette, we introduce some of those functions, for further detail please check the additional vignettes <code>vignette("GHRmodel_covariates")</code> and <code>vignette("GHRmodel_DLNM")</code> where advanced options including replicated, varying, interacting effects and Distributed Lag Non-linear Models (DLNM) are explained.</p>
<p>The <strong>GHRmodel</strong> covariate helper functions use a common structure to select covariates:</p>
<ul>
<li><p><code>pattern</code>: for partial string matching, selecting groups of covariates that share a common prefix (e.g., ‚Äútmin‚Äù would match ‚Äútmin.l1‚Äù, ‚Äútmin.l2‚Äù, etc.).</p></li>
<li><p><code>name</code>: for exact matching of covariate names</p></li>
</ul>
<p>For all functions with the prefix <code>cov_*</code>, the input is a character vector or a list of character vectors representing covariate names specified in the <code>covariates</code> argument (which can be generated using the <code>extract_names()</code> function). The output is a list of covariates that may be combined or transformed, formatted for INLA formulas. <code>add</code>: is a logical flag indicating whether to retain original covariates in addition to transformed or combined ones in the output.</p>
<ul>
<li><strong>Select variables to include in the model formulas</strong></li>
</ul>
<p>Users can specify which variables from the data set to include as covariates using the <code>extract_names()</code> function. It outputs a character vector of variable names.</p>
<p>Here we select lags 1 through 6 for <em>tmin</em> and <em>pdsi</em>. By including <code>"tmin."</code> and <code>"pdsi."</code> in the <code>pattern</code> argument, we capture all columns that match these prefixes (e.g., <em>tmin.l1</em>, <em>tmin.l2</em>, ‚Ä¶, <em>pdsi.l6</em>).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract variable names matching the specified patterns</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>cov_names <span class="ot">&lt;-</span> <span class="fu">extract_names</span>(<span class="at">data =</span> data,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"tmin."</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"pdsi."</span>))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: character vector of covariate names</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(cov_names)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  chr [1:12] "tmin.l1" "tmin.l2" "tmin.l3" "tmin.l4" "tmin.l5" "tmin.l6" "pdsi.l1" "pdsi.l2" "pdsi.l3" "pdsi.l4" "pdsi.l5" ...</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><strong>Generate list of linear covariates for univariable models</strong></li>
</ul>
<p>The <code>cov_uni()</code> function returns a list where each element contains a single covariate. This structure is suitable for fitting separate univariable models.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate list of single linear covariate names</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>uni_cov_lin <span class="ot">&lt;-</span> <span class="fu">cov_uni</span>(<span class="at">covariates =</span> cov_names, <span class="co"># Input character vector of covariate names</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"pdsi.l"</span>,  <span class="co"># Select lagged pdsi and tmin from the vector of covariate names</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"tmin.l"</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: list of single linear covariate names</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(uni_cov_lin,<span class="dv">2</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l1"</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l2"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><strong>Generate list of non-linear covariates for univariable models</strong></li>
</ul>
<p>To include non-linear covariates in the model, the <code>cov_nl()</code> function generates non-linear effect terms compatible with the INLA formula structure (for more information see how to <a href="https://becarioprecario.bitbucket.io/inla-gitbook/ch-smoothing.html#sec:smoothterms">smooth terms in INLA</a>). The non-linear transformation is defined using three main arguments that are passed into <code>inla.group()</code>:</p>
<ul>
<li><p>The type of non-linear effect is controlled by the <code>model</code> argument, which supports <code>"rw1"</code> (random walk of order 1) or <code>"rw2"</code> (random walk of order 2), and defaults to <code>"rw2"</code>.</p></li>
<li><p>The <code>method</code> argument allows the user to specify how to discretize the linear covariate. Accepted values are <code>"cut"</code> (equal-width intervals) and <code>"quantile"</code> (equal-width intervals in the probability space). The default is <code>"quantile"</code>.</p></li>
<li><p>The <code>n</code> argument sets the number of basis points (breaks) used to approximate the non-linear effect and defaults to 10.</p></li>
</ul>
<blockquote class="blockquote">
<p>üí° <strong>Tip</strong>: Choosing a low <code>n</code> will result in a smoother function (at the risk of underfitting) whereas a high <code>n</code> will lead into a more flexible function (at the risk of overfitting). Make sure to explore and plot your data and check goodness-of-fit metrics to get the best possible fit!</p>
</blockquote>
<blockquote class="blockquote">
<p>üìù <strong>Note</strong>: In addition to <code>cov_nl</code>, <strong>GHRmodel</strong> provides the <code>onebasis_inla()</code> function for nonlinear covariate transformations. This function supports natural splines (<code>"ns"</code>), B-splines (<code>"bs"</code>), polynomial (<code>"poly"</code>), and other options from <code>dlnm::onebasis()</code>. For more information about one-basis terms see the <em>Complex Covariate Structures in GHRmodel</em> vignette by typing <code>vignette("GHRmodel_covariates")</code>.</p>
</blockquote>
<p>Here we transform the 1- to 6-month lagged <em>tmin</em> and <em>pdsi</em> variables into non-linear terms using a random walk of order 2 (<code>model = "rw2"</code>). We apply 10 breaks (<code>n= 10</code>) to discretize the covariates using <code>method = "quantile"</code>, which ensures each bin contains a similar number of observations. By setting <code>add = FALSE</code>, the resulting list only includes the transformed variables.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate list of single non-linear covariate names</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>uni_cov_nl <span class="ot">&lt;-</span> <span class="fu">cov_nl</span>(<span class="at">covariates =</span> cov_names, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">"quantile"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">model =</span> <span class="st">"rw2"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"pdsi"</span>, <span class="st">"tmin"</span>), </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">add =</span><span class="cn">FALSE</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: list of single non-linear covariate names</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(uni_cov_nl,<span class="dv">2</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(tmin.l1, method='quantile', n=10), model='rw2')"</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(tmin.l2, method='quantile', n=10), model='rw2')"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><strong>Generate list of covariates for multivariable models</strong></li>
</ul>
<p>The <code>cov_multi()</code> function takes a character vector (such as the output of <code>extract_covariates()</code>) or a list of character vectors (e.g., output from <code>cov_uni()</code> or <code>cov_nl()</code>) and generates all possible combinations. This is useful for constructing multivariable models where the user wishes to explore joint effects of different covariates.</p>
<p>Here we generate all two-way combinations of the linear and non-linear covariates containing ‚Äútmin‚Äù and ‚Äúpdsi‚Äù listed in the <code>uni_cov_lin</code> and <code>uni_cov_nl</code> objects:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate list of combinations of linear covariate names</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>multi_cov_lin <span class="ot">&lt;-</span> <span class="fu">cov_multi</span>(<span class="at">covariates =</span> uni_cov_lin,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"pdsi"</span>,<span class="st">"tmin"</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">add =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: list of combinations of linear covariate names</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(multi_cov_lin,<span class="dv">2</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l1" "tmin.l1"</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l2" "tmin.l1"</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate list of combinations of non-linear covariate names</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>multi_cov_nl <span class="ot">&lt;-</span> <span class="fu">cov_multi</span>(<span class="at">covariates =</span> uni_cov_nl,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"pdsi"</span>,<span class="st">"tmin"</span>),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">add =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: list of combinations of non-linear covariate names</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(multi_cov_nl,<span class="dv">2</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(pdsi.l1, method='quantile', n=10), model='rw2')"</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] "f(INLA::inla.group(tmin.l1, method='quantile', n=10), model='rw2')"</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(pdsi.l2, method='quantile', n=10), model='rw2')"</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] "f(INLA::inla.group(tmin.l1, method='quantile', n=10), model='rw2')"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><br></p>
<p>See <code>vignette("GHRmodel_covariates")</code> for details on how to generate INLA-compatible formulas with complex covariate structures.</p>
</section>
<section id="write-formulas" class="level3">
<h3 class="anchored" data-anchor-id="write-formulas">Write formulas</h3>
<p>To fit models with <strong>GHRmodel</strong>, formulas must be provided as a <code>GHRformulas</code> object. Here we outline the steps needed to convert a character vector of INLA-compatible formulas into this required format.</p>
<ol type="1">
<li><strong>Define priors</strong></li>
</ol>
<p>Bayesian models require priors to be assigned to the parameters that the model will estimate. These priors govern the variability and structure of the latent components and are a core element of Bayesian model specification. It is good practice to pre-define priors before writing model formulas. For more details about priors in R-INLA, see <a href="https://becarioprecario.bitbucket.io/inla-gitbook/ch-priors.html">this book chapter</a> (G√≥mez-Rubio, 2020)</p>
<ul>
<li><p>The prior distributions for fixed effects and intercept parameters use R-INLA‚Äôs default: Gaussian distributions with <code>mean = 0</code> and <code>precision = 0.001</code>) (Moraga, 2019). These default priors are centered at 0 and therefore do not assume any prior knowledge about the direction of the effects.</p></li>
<li><p>Prior distributions for hyperparameters associated with structured random effects (e.g., <code>rw1</code>, <code>iid</code>, <code>bym2</code>) must be specified by the user.<br>
Below, we define priors for the monthly, yearly and spatial structured random effects:</p></li>
</ul>
<p>The monthly and yearly random effects are assigned weakly informative Gamma priors on the precision with parameters <code>0.01</code> and <code>0.01</code> (G√≥mez-Rubio, 2020).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Gamma priors for the precision of temporal random effects</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>prior_t <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">prec =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">'loggamma'</span>, <span class="at">param =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>))) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The spatial random effect is modeled with a BYM2 specification, which combines spatially structured and unstructured components. This formulation facilitates assigning Penalized Complexity (PC) priors to model parameters (Simpson et al., 2017). PC priors are recommended because they penalize model complexity, shrinking toward simpler structures unless the data provide strong evidence otherwise. Additionally, they allow users to set priors on interpretable scales, such as the standard deviation of random effects.</p>
<ul>
<li><p>The <code>prec</code> prior controls the magnitude of spatial variation. Using a rule of thumb from Simpson et al.&nbsp;(2017), we assign prior parameters such that the probability that the marginal standard deviation exceeds 0.5 is 0.01 (Moraga, 2019; Simpson et al., 2017).</p></li>
<li><p>The <code>phi</code> prior controls the proportion of variance explained by the structured spatial component. We use a conservative prior that assumes the unstructured (random noise) effect explains more variation than the spatially structured effect (Moraga, 2019).</p></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define penalized complexity (PC) priors for spatial random effects using BYM2</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>prior_sp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prec =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">'pc.prec'</span>, <span class="at">param =</span> <span class="fu">c</span>(<span class="fl">0.5</span> <span class="sc">/</span> <span class="fl">0.31</span>, <span class="fl">0.01</span>)),  <span class="co"># Precision of spatial effect</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">phi  =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">'pc'</span>, <span class="at">param =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>))              <span class="co"># Mixing parameter: structured vs unstructured</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="2" type="1">
<li><strong>Write INLA-compatible model formulas from a list of covariates</strong></li>
</ol>
<p>The <code>write_inla_formulas()</code> function simplifies the creation of multiple INLA-compatible model formulas by automatically structuring fixed effects, random effects, and interactions. This includes:</p>
<ul>
<li><p>Flexible model construction: Accepts a list of covariate sets, enabling batch creation of INLA-compatible model formulas for comparison or model selection workflows.</p></li>
<li><p>Baseline model inclusion: If <code>baseline = TRUE</code> (default), the function adds a baseline model as the first element in the list. This is either an intercept-only model (if no random effects are specified) or a random-effects-only model.</p></li>
<li><p>Structured random effects: Supports up to five random effects through the arguments <code>re1</code> to <code>re5</code>. Each random effect is defined with its own ID variable (<code>id</code>) and model type (e.g.,<code>model</code> = ‚Äúiid‚Äù, ‚Äúrw1‚Äù, ‚Äúrw2‚Äù, ‚Äúbym‚Äù, or ‚Äúbym2‚Äù). Optional fields include replication (<code>replicate</code>), hierarchical grouping (<code>group</code>), spatial structure (<code>graph</code>), cyclic effects (<code>cyclic</code>), scaling (<code>scale.model</code>), and custom hyperparameters (<code>hyper</code>). While effects included in arguments <code>re1</code> to <code>re5</code>are shared across all model formulas, effects defined by the <code>covariates</code> argument can differ between models.</p></li>
</ul>
<p>For details see <code>?write_inla_formulas</code>.</p>
<p>First we compile a list of covariate combinations, where each element in the list corresponds to a distinct model specification. This list will be referenced in the <code>covariates</code> argument in <code>write_inla_formulas()</code>. In this example, covariates are selected to illustrate both linear and non-linear effects for visualization purposes below.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>cov_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(uni_cov_lin[[<span class="dv">7</span>]],    <span class="co"># Include linear tmin.l1 </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                   uni_cov_nl[[<span class="dv">1</span>]],     <span class="co"># Include non-linear tmin.l1</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                   multi_cov_lin[[<span class="dv">1</span>]],  <span class="co"># Include linear "pdsi.l1" "tmin.l1"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                   multi_cov_nl[[<span class="dv">1</span>]]),  <span class="co"># Include non-linear "pdsi.l1" "tmin.l1" combination</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>              uni_cov_nl[<span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>])         <span class="co"># Include non-linear terms for pdsi.l1 through pdsi.l6</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the first 3 elements of the covariate list</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cov_list, <span class="dv">4</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "tmin.l1"</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(tmin.l1, method='quantile', n=10), model='rw2')"</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l1" "tmin.l1"</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(pdsi.l1, method='quantile', n=10), model='rw2')"</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] "f(INLA::inla.group(tmin.l1, method='quantile', n=10), model='rw2')"</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># The result is a list</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(cov_list)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "list"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Next, we generate a set of model formulas by inputting the covariate list into the <code>write_inla_formulas()</code> function:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a list of INLA-compatible model formulas including outcome, covariates, and random effects</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>formulas_cov_list <span class="ot">&lt;-</span> <span class="fu">write_inla_formulas</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Outcome (dependent variable) in all formulas</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"dengue_cases"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># List of covariate sets to be included in the formulas (generated earlier as cov_list)</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">covariates =</span> cov_list,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First random effect: monthly seasonality</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">re1 =</span> <span class="fu">list</span>(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">id        =</span> <span class="st">"month_id"</span>,      <span class="co"># Time index for monthly effect</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">model     =</span> <span class="st">"rw1"</span>,           <span class="co"># First-order random walk model</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cyclic    =</span> <span class="cn">TRUE</span>,            <span class="co"># Enforce cyclicity over months (Dec ‚Üí Jan wrap-around)</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper     =</span> <span class="st">"prior_t"</span>,       <span class="co"># Hyperprior object for precision</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">replicate =</span> <span class="st">"spat_meso_id"</span>   <span class="co"># Separate seasonal pattern per mesoregion</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Second random effect: inter-annual trend</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">re2 =</span> <span class="fu">list</span>(</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">id    =</span> <span class="st">"year_id"</span>,           <span class="co"># Year index</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">"iid"</span>,               <span class="co"># Independent and identically distributed</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper =</span> <span class="st">"prior_t"</span>            <span class="co"># Hyperprior for temporal smoothness</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Third random effect: spatial autocorrelation</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">re3 =</span> <span class="fu">list</span>(</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">id    =</span> <span class="st">"spat_id"</span>,           <span class="co"># Spatial unit identifier</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">"bym2"</span>,              <span class="co"># BYM2 spatial model (structured + unstructured)</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph =</span> <span class="st">"g"</span>,                 <span class="co"># Pre-computed spatial adjacency graph</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper =</span> <span class="st">"prior_sp"</span>           <span class="co"># PC priors for BYM2 model parameters</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Include a baseline random effect-only model formula as 1st element in the list</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline =</span> <span class="cn">TRUE</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of INLAcompatible model formula generated</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>formulas_cov_list[<span class="dv">2</span>]</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "dengue_cases ~ 1 + tmin.l1 + f(month_id, model = 'rw1', replicate = spat_meso_id, cyclic = TRUE, hyper = prior_t) + f(year_id, model = 'iid', hyper = prior_t) + f(spat_id, model = 'bym2', graph = g, hyper = prior_sp)"</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Outputs a character vector of model formulas</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(formulas_cov_list)</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "character"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="3" type="1">
<li><strong>Convert model formulas to a <code>GHRformulas</code> object</strong></li>
</ol>
<p>Here we use the <code>as_GHRformulas()</code> function to convert the output from <code>write_inla_formulas()</code> into a standardized <code>GHRformulas</code> object:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>formulas_cov_list_ghr <span class="ot">&lt;-</span> <span class="fu">as_GHRformulas</span>(<span class="at">formulas =</span> formulas_cov_list)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Outputs a GHRformulas object</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(formulas_cov_list_ghr)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "GHRformulas" "list"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="model-fitting-1" class="level2">
<h2 class="anchored" data-anchor-id="model-fitting-1">2. Model fitting</h2>
<p>The <code>fit_models()</code> function allows users to fit a set of INLA-compatible models defined by a <code>GHRformulas</code> object to a provided data set. It automates model fitting, extraction of outputs, and computation of a wide range of goodness-of-fit (GoF) metrics. It also facilitates model selection: if a baseline model (e.g., random effects-only) is included as the first entry in the formula list‚Äîas when generated via <code>write_inla_formulas(..., baseline = TRUE)</code>‚Äîthe function highlights how subsequent models improve on this baseline across multiple dimensions.</p>
<p><strong>Inputs</strong></p>
<p><code>formulas</code>: A <code>GHRformulas</code> object containing one or more INLA model formulas.</p>
<p><code>data</code>: The dataset containing variables used in the model.</p>
<p><code>family</code>: The likelihood family (currently supports: <code>"poisson"</code>, <code>"nbinomial"</code>).</p>
<p><code>name</code>: user-defined prefix label for each model.</p>
<p><code>control_compute</code>: Options for computing posterior predictive distributions (<code>config = TRUE</code>) or returning the variance-covariance matrix.</p>
<p><code>offset</code> (optional): A variable in data to be used as an offset. The function will automatically apply the natural logarithm to this variable.</p>
<p><code>pb</code>: Toggle progress bar indicating the last model run.</p>
<p><code>nthreads</code>: Number of threads for parallel model fitting. A low-end laptop can handle 4-8 threads.</p>
<p><strong>Outputs</strong> The function returns a <code>GHRmodels</code> object that includes:</p>
<ul>
<li><p><code>GHRmodels$fitted</code>: A list of fitted values (one element per model). If <code>config = TRUE</code>, these are derived from the posterior predictive distribution (PPD); otherwise, they are extracted from INLA‚Äôs <em>summary.fitted.values</em>.</p></li>
<li><p><code>GHRmodels$formulas</code>, <code>GHRmodels$data</code>: Original formulas and dataset.</p></li>
<li><p><code>GHRmodels$mod_gof</code>: A data frame with a comprehensive suite of goodness-of-fit Metrics (GoF) metrics. If <code>config = TRUE</code>, these are calculated using the posterior predictive distribution (PPD) when applicable; otherwise using INLA‚Äôs <code>summary.fitted.values.</code></p></li>
<li><p><strong>DIC</strong>: Deviance Information Criterion.</p></li>
<li><p><strong>WAIC</strong>: Watanabe-Akaike Information Criterion.</p></li>
<li><p><strong>LMS</strong>: Log Mean Score based on Conditional Predictive Ordinate.</p></li>
<li><p><strong>MAE</strong>: Mean Absolute Error.</p></li>
<li><p><strong>RMSE</strong>: Root Mean Squared Error.</p></li>
<li><p><strong>CRPS</strong>: Continuous Ranked Probability Score (requires <code>config = TRUE</code>).</p></li>
<li><p><strong>Pseudo R¬≤</strong>: Improvement over a baseline model based on deviance.</p></li>
<li><p><strong>Random Effect Variance</strong>: Inverse of median precision.</p></li>
</ul>
<p>Additionally, differences in each metric relative to the baseline model are reported (it assumes that the baseline model is the first in the list of formulas, as occurs when the formulas are produced using <code>write_inla_formulas</code> where <code>baseline = TRUE</code>).</p>
<ul>
<li><p>Relative metric difference between each model and the first model: stored in variables named with the metric name and suffix <em>‚Äúvs_first‚Äù</em> (for example, <em>‚Äúwaic_vs_first‚Äù</em>).</p></li>
<li><p>Credible intervals for metric differences: Values of the lower credible interval of the difference are named with the metric name and suffix <em>‚Äúvs_first_lci‚Äù</em> and for the upper credible interval of the difference the suffix <em>‚Äúvs_first_uci‚Äù</em>.</p></li>
<li><p>Relative change in random effect variance (proportion), quantifying how much variability is explained by covariates: stored in variables named with the metric name and suffix <em>‚Äúvar_change‚Äù</em> (for example, <em>‚Äúre_1_var_change‚Äù</em>)</p></li>
</ul>
<p>For more information about how these metrics are calculated and what they measure, see <code>?fit_models</code>.</p>
<p>This example demonstrates fitting a set of negative binomial models defined by the <code>GHRformulas</code> object (<em>formulas_cov_list_ghr</em>) constructed above, with an offset term to account for population exposure. After fitting, goodness-of-fit metrics can be extracted as a data frame directly through the <code>GHRmodels$mod_gof</code> element.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>model_list <span class="ot">&lt;-</span> <span class="fu">fit_models</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formulas =</span> formulas_cov_list_ghr, <span class="co"># GHRformulas object</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,                      <span class="co"># Data to fit the models </span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"nbinomial"</span>,             <span class="co"># Negative binomial likelihood</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"mod"</span>,                     <span class="co"># Label prefix for each model</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="st">"population"</span>,            <span class="co"># Offset variable to account for population size</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">control_compute =</span> <span class="fu">list</span>(</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">config =</span> <span class="cn">FALSE</span>,                 <span class="co"># Extract from INLA summary.fitted.values</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">vcov =</span> <span class="cn">FALSE</span>                    <span class="co"># Do not return variance-covariance matrix</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">nthreads =</span> <span class="dv">8</span>                      <span class="co"># Use 8 threads for parallel computation</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Outputs a GHRmodels object</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(model_list)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract goodness of fit metrics as a data.frame</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>model_list_gof <span class="ot">&lt;-</span> model_list<span class="sc">$</span>mod_gof </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="model-evaluation-1" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation-1">3. Model evaluation</h2>
<p>Most, but not all, model evaluation functions in the GHR package suite return graphical <code>ggplot2</code> or <code>cowplot</code> objects and require a <code>GHRmodels</code> object as input. Users can customize visual outputs using standard <code>ggplot2</code> syntax.</p>
<section id="rank-models" class="level3">
<h3 class="anchored" data-anchor-id="rank-models">Rank models</h3>
<p>The <code>rank_models()</code> function provides a simple way to rank models stored in a <code>GHRmodels object</code> based on a selected GoF metric. This function supports any of the GoF metrics or relative metrics output in the <code>mod_gof</code> component of a <code>GHRmodels</code> object ( see <code>?fit_models</code>).</p>
<p>Here we rank models based on WAIC and return the top 2 models with the lowest WAIC values.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>best_waic <span class="ot">&lt;-</span> <span class="fu">rank_models</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> model_list,  <span class="co"># GHRmodels object containing model fit results</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"waic"</span>,      <span class="co"># Metric used to rank models (lower WAIC is better)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">2</span>                 <span class="co"># Number of top-ranked models to return</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the model IDs of the two best models</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>best_waic</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "mod5" "mod3"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="posterior-predictive-checks" class="level3">
<h3 class="anchored" data-anchor-id="posterior-predictive-checks">Posterior predictive checks</h3>
<p>Posterior predictive checks allow users to evaluate how well a model captures the distribution of observed data by comparing it to samples generated from the model‚Äôs predictive distribution.</p>
<p>The function <code>sample_ppd()</code> refits a specified model from a <code>GHRmodels</code> object and generates samples from its posterior predictive distribution. The output is a <code>data.frame</code> with posterior predictive samples and an observed column for the actual outcomes.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ppd_df <span class="ot">&lt;-</span> <span class="fu">sample_ppd</span>( </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  model_list,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="st">"mod3"</span>, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">s =</span> <span class="dv">100</span>, <span class="co"># Increase to have more robust results</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nthreads =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>plot_ppd()</code> function takes the output from <code>sample_ppd()</code> and creates a density plot comparing the distributions of the posterior predictive (purple line) with the observed data (black line). This visual comparison helps assess model fit and detect discrepancies between the predicted and observed outcome distributions.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ppd</span>(ppd_df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/plot_ppd-1.png" style="display: block; margin: auto;"></p>
</section>
<section id="goodness-of-fit-metrics" class="level3">
<h3 class="anchored" data-anchor-id="goodness-of-fit-metrics">Goodness-of-fit metrics</h3>
<p>The <code>plot_gof()</code> function provides a convenient way to visualize and compare the performance of multiple models using a selected goodness-of-fit (GoF) metric, such as DIC, WAIC, RMSE, or CRPS. It is typically used with the <code>mod_gof</code> component of a <code>GHRmodels</code> object (produced by <code>fit_models()</code>), but it can also accept any custom data frame ‚Äî provided it contains the same column names as the default <code>mod_gof</code> output (including <code>model_id</code> and the relevant metric column names). A key feature of <code>plot_gof()</code> is its ability to visually arrange and distinguish models by mapping any column in the input data frame to plot aesthetics such as color, shape, or facet layout. This makes it easy for the user to customize the input data frame to organize models by additional user-defined categories (e.g., <em>environmental variables</em> or <em>dlnm models</em>). Further, the plot supports customization by allowing users to specify which models to include, apply custom labels, and optionally display 95% credible intervals for metrics like <code>dic_vs_first</code> or <code>waic_vs_first</code>.</p>
<p>Here we assess how the inclusion of different covariates impacts model performance using <code>plot_gof()</code> to compare each model‚Äôs WAIC against that of a baseline model (<code>waic_vs_first</code>). Before plotting, we annotate each model in the <code>model_list$mod_gof</code> dataframe with descriptive labels that classify the type of transformation applied to each covariate.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotate each model in the model_list$mod_gof dataframe with descriptive labels</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>model_list_gof <span class="ot">&lt;-</span> model_list<span class="sc">$</span>mod_gof <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Variable transformation 1st covariate</span><span class="st">`</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"_nl"</span>, covariate_1, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"non-linear"</span>, </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(covariate_1) <span class="sc">~</span> <span class="st">"baseline"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      T <span class="sc">~</span> <span class="st">"linear"</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Covariates</span><span class="st">`</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"tmin"</span>, covariate_1, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span> <span class="fu">is.na</span>(covariate_2) <span class="sc">~</span> <span class="st">"tmin"</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"pdsi"</span>, covariate_1, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span> <span class="fu">is.na</span>(covariate_2) <span class="sc">~</span> <span class="st">"pdsi"</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(covariate_1) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(covariate_2) <span class="sc">~</span> <span class="st">"tmin + pdsi"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(covariate_1) <span class="sc">~</span> <span class="st">"random effect only"</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>In this plot we observe that models that included a non-linear term for the previous month‚Äôs mean temperature (<em>tmin.l1</em>) improved model fit relative to the baseline most.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot change in WAIC for each model compared to the baseline (first model in the list)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_gof</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_gof =</span> model_list_gof,            <span class="co"># Goodness-of-fit data from model_list</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"waic_vs_first"</span>,            <span class="co"># Compare WAIC to the first model (baseline)</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ci =</span> <span class="cn">TRUE</span>,                           <span class="co"># Include credible intervals (if available)</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_arrange =</span> <span class="st">"waic_vs_first"</span>,       <span class="co"># Arrange models by WAIC difference</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_color =</span>  <span class="st">"Variable transformation 1st covariate"</span>,    <span class="co"># variable transformation</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_shape =</span> <span class="st">"Covariates"</span>,  <span class="co"># Shape mapped to including tmin.l1</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"Colorblind"</span>)    </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/plot_gof covariate 1 and 2-1.png" style="display: block; margin: auto;"></p>
</section>
<section id="fitted-vs.-observed" class="level3">
<h3 class="anchored" data-anchor-id="fitted-vs.-observed">Fitted vs.&nbsp;Observed</h3>
<p>The <code>plot_fit()</code> function allows users to visually assess model performance by comparing observed case counts with fitted values over time from one or more models stored in a <code>GHRmodels</code> object. It allows:</p>
<ul>
<li><p>Time-series comparison of observed and fitted values.</p></li>
<li><p>Option to facet by model ID using <code>mod_facet = TRUE</code> and/or group (e.g., spatial unit) using the <code>group</code> and <code>group_id</code> arguments.</p></li>
<li><p>Add 95% credible intervals around fitted estimates.</p></li>
<li><p>Supports custom model labels, color palettes, and cropping the plot window to a date range (e.g., <em>c(‚Äú2010-01-01‚Äù, ‚Äú2020-12-31‚Äù)</em>)..</p></li>
</ul>
<p>Here we observe that the best-fitting model by WAIC performs better during some dengue outbreaks than the baseline random-effect-only model (especially in 2010, 2015 and 2016).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot observed vs. fitted cases over time for three selected models</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_fit</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> model_list,                         <span class="co"># A GHRmodels object (fitted models)</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="fu">c</span>(<span class="st">"mod1"</span>, <span class="st">"mod3"</span>, <span class="st">"mod5"</span>),          <span class="co"># Vector of model IDs to plot</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_label =</span> <span class="fu">c</span>(<span class="st">"Baseline"</span>,                    <span class="co"># Custom display names </span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"tmin.l1.nl"</span>,            </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pdsi.l1.nl_tmin.l1.nl"</span>),            </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_color =</span> <span class="st">"grey"</span>,                          <span class="co"># Color override for the ref model (first)</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="st">"date"</span>,                               <span class="co"># Name of the time variable in the dataset</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"Set2"</span>,                            <span class="co"># Color palette for fitted lines</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="st">"2010-01-01"</span>, <span class="st">"2020-01-01"</span>),        <span class="co"># Limit x-axis to this date range</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Fitted vs Observed"</span>                 <span class="co"># Main plot title</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/plot_fit default-1.png" style="display: block; margin: auto;"></p>
<p><br> Here we visualize how well each model‚Äôs predictions match the observed case counts over time, grouped by the region ID <em>meso_code</em>. Faceting (<code>mod_facet = TRUE</code>) allows for side-by-side visual comparison of different modeling strategies. The log-transformed y-axis using <code>transform = "log10p1"</code> applies a log10(x + 1) transformation for improved visibility where count data vary greatly in scale.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot observed vs. fitted values from multiple models with faceted panels by model</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_fit</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> model_list,                          <span class="co"># GHRmodels object containing fitted models</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="fu">c</span>(<span class="st">"mod1"</span>, <span class="st">"mod4"</span>),                  <span class="co"># Vector of model IDs to plot</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_label =</span> <span class="fu">c</span>(<span class="st">"Baseline"</span>,                    <span class="co"># Custom display name for mod1</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pdsi.l1_tmin.l1"</span>),            <span class="co"># Custom display name for mod4</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="st">"date"</span>,                               <span class="co"># Name of the time variable</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"meso_name"</span>,                         <span class="co"># Column defining grouped time-series (meso region)</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">group_id =</span> <span class="fu">c</span>(<span class="st">"Pantanais Sul Mato-Grossense"</span>, <span class="co"># Select specific groups to display</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Leste De Mato Grosso Do Sul"</span>),</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="st">"log10p1"</span>,                       <span class="co"># Apply log10(x + 1) transformation to y-axis for scaling</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"Set2"</span>,                            <span class="co"># Color palette for model fits</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_facet =</span> <span class="cn">TRUE</span>,                            <span class="co"># Facet by model to compare fits across panels</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_color =</span> <span class="st">"purple"</span>,                        <span class="co"># Line color for observed case counts</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_label =</span> <span class="st">"Observed cases"</span>,                <span class="co"># Legend label for observed values</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_color =</span> <span class="st">"grey"</span>,                          <span class="co"># Override color for the reference model</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Fitted models vs. Observed Cases"</span>,  <span class="co"># Main plot title</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">ci =</span> <span class="cn">FALSE</span>                                   <span class="co"># Do not plot credible intervals</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/plot_fit facet by group-1.png" width="100%" style="display: block; margin: auto;"></p>
</section>
<section id="covariate-effects" class="level3">
<h3 class="anchored" data-anchor-id="covariate-effects">Covariate effects</h3>
<p><strong>Linear coefficients</strong></p>
<p>The <code>plot_coef_lin()</code> function generates a forest plot of fixed-effect (linear) coefficients from one or more models stored in a <code>GHRmodels</code> object. This plot provides a visual summary of point estimates and uncertainty (e.g., credible intervals) for linear covariates, helping to interpret the strength and direction of modeled associations.</p>
<p>By default, the function plots all linear fixed-effect terms except the intercept. Users can filter the coefficients by exact variable names (<code>name</code>) or matching patterns (<code>pattern</code>), including interaction terms. If users do not select specific <em>model_id</em>s, by default the function plots all linear effects across all models in a provided <code>GHRmodels</code> object. Note that if any of the models contains a cross-basis covariate the function will plot the coefficients for each element in the cross-basis matrix (for more information about one-basis and cross-basis terms see the <em>Distributed Lag Nonlinear Models in GHRmodel</em> vignette by typing <code>vignette("GHRmodel_DLNM")</code>).</p>
<p>This plot shows point estimates with confidence intervals for the linear covariates in <code>model_list</code>, enabling comparison of their effects across models. We observe that higher mean minimum temperatures lagged by one month, as well as wetter conditions at the same lag, are both associated with a significant increase in dengue cases.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coef_lin</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> model_list,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="fu">c</span>(<span class="st">"mod2"</span>,<span class="st">"mod4"</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_label =</span> <span class="fu">c</span>(<span class="st">"tmin.l1"</span><span class="ot">=</span> <span class="st">"Min. temp lag 1"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pdsi.l1"</span> <span class="ot">=</span> <span class="st">"Drought index lag 1"</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Effects of linear covariates"</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/pot_coef_lin-1.png" style="display: block; margin: auto;"></p>
<p><br> <strong>Non-linear coeficients</strong></p>
<p>The <code>plot_coef_nl()</code> function generates plots of nonlinear effects from one or more fitted models contained within a <code>GHRmodels</code> object. It visualizes nonlinear covariates (typically created with <code>inla.group()</code>). Users can select non-linear terms to display by <code>name</code> or <code>pattern</code>, and customize labels, axes, and color palettes. The function supports two main display modes:</p>
<ul>
<li><p><strong>Grid</strong> (<code>collapse = FALSE</code>): one plot per covariate and model, with effects by column and models by row. If multiple models are specified in <code>mod_id</code>, the user must explicitly select which nonlinear covariates to plot using either <code>name</code> or <code>pattern</code>. If only one model is provided then all nonlinear effects will be plotted unless specific ones are selected in <code>name</code> or <code>pattern</code>.</p></li>
<li><p><strong>Collapsed</strong> (<code>collapse = TRUE</code>): one non-linear effect combined across models into a single panel. This display mode can only be used when the selected non-linear effect is not replicated across groups (e.g., random effects replicated by <em>meso_area</em>) using the <code>f(INLA::inla.group(covariate,...), model= "rw2", replicate = group)</code> format (for more information on replicated effects see <code>vignette("GHRmodel_covariates")</code>).</p></li>
</ul>
<p>To show the distribution of the covariate values, the function provides 2 possibilities. By default, the function overlays a <strong>rug plot</strong> on the x-axis, which can be removed with <code>rug = FALSE</code>. Optionally, a <strong>histogram</strong> can be shown below each plot by setting <code>histogram = TRUE</code>.</p>
<p>Here we plot six models with a non-linear term of PDSI at one to six month lags. We observe that there is an effect of very wet conditions on dengue cases at one month lag, while there is no effect at 2 and 3 lags previous and the relationship inverts at longer lags:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coef_nl</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># List of fitted models from which to extract nonlinear effects</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> model_list,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Model IDs to include in the plot (must match names in `model_list`)</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"mod"</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">11</span>)),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Custom labels for the selected models (used for legend or facet titles)</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_label =</span> <span class="fu">c</span>(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod6"</span>  <span class="ot">=</span> <span class="st">"pdsi.l1_nl"</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod7"</span> <span class="ot">=</span> <span class="st">"pdsi.l2_nl"</span>, </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod8"</span> <span class="ot">=</span> <span class="st">"pdsi.l3_nl"</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod9"</span> <span class="ot">=</span> <span class="st">"pdsi.l4_nl"</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod10"</span> <span class="ot">=</span> <span class="st">"pdsi.l5_nl"</span>, </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod11"</span> <span class="ot">=</span> <span class="st">"pdsi.l6_nl"</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Custom labels for the nonlinear covariates (used in axis or strip labels)</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_label =</span> <span class="fu">c</span>(</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pdsi.l1"</span> <span class="ot">=</span> <span class="st">"Drought index (PDSI) lag 1"</span>,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pdsi.l2"</span> <span class="ot">=</span> <span class="st">"Drought index (PDSI) lag 2"</span>,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pdsi.l3"</span> <span class="ot">=</span> <span class="st">"Drought index (PDSI) lag 3"</span>,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pdsi.l4"</span> <span class="ot">=</span> <span class="st">"Drought index (PDSI) lag 4"</span>,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pdsi.l5"</span> <span class="ot">=</span> <span class="st">"Drought index (PDSI) lag 5"</span>, </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pdsi.l6"</span> <span class="ot">=</span> <span class="st">"Drought index (PDSI) lag 6"</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Include only variables whose names contain "pdsi"</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"pdsi"</span>,</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Title for the entire plot</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Change in non-linear term for drought index (PDSI) with and without mean min. temp lag 1"</span>,</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Label for the x-axis</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"PDSI"</span>,</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Color palette to use for plotting (a predefined IDExtremes palette)</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"IDE2"</span>,</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Grid display mode</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">collapse =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Disable rug plot on the x-axis</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">rug =</span> <span class="cn">FALSE</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/plot_coef_nl grid 6 variables-1.png" style="display: block; margin: auto;"></p>
<p><br> Here we plot 2 models with a non-linear term of PDSI at one month lag, with and without an additional non-linear term for mean minimum temperature at one-month lag in collapsed mode. We observe that the effect of PDSI does not change substantially when a temperature covariate is added:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coef_nl</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> model_list,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="fu">c</span>( <span class="st">"mod5"</span>, <span class="st">"mod6"</span>) ,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_label =</span> <span class="fu">c</span>(<span class="st">"mod6"</span> <span class="ot">=</span> <span class="st">"pdsi.l1_nl"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"mod5"</span> <span class="ot">=</span> <span class="st">"pdsi.l1_nl + tmin.l1_nl"</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_label =</span> <span class="fu">c</span>(<span class="st">"pdsi.l1"</span> <span class="ot">=</span> <span class="st">"Drought index (PDSI)"</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"pdsi.l1"</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Change in non-linear term for drought index (PDSI) </span><span class="sc">\n</span><span class="st"> with and without mean min. temp lag 1"</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"PDSI"</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"IDE2"</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">collapse =</span> <span class="cn">TRUE</span>         <span class="co"># Combine all plots into a single panel</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/plot_coef_nl collapse 2 variables-1.png" style="display: block; margin: auto;"></p>
</section>
<section id="evaluate-random-effects" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-random-effects">Evaluate random effects</h3>
<p>The <code>plot_re()</code> function provides flexible tools for visualizing spatial or temporal random effects from a fitted <code>GHRmodels</code> object. It supports replicated or grouped effects via the <code>rep_id</code> argument and allows customization of labels, color palettes, and legend titles. Depending on the input, it can produce either:</p>
<ul>
<li><p><strong>Caterpillar plots</strong> of estimated median effect sizes with uncertainty intervals, or</p></li>
<li><p><strong>Spatial maps</strong> (when plotting spatial random effects and an <code>sf</code> object is provided) display the geographic distribution of estimated median random effects across spatial units. To enable this, users must specify the <code>map_area</code> argument, which defines the column in the sf object that uniquely identifies each spatial unit. It is essential that the values in this column match exactly with the spatial IDs (<code>re_id</code>) used in the model to ensure proper alignment and accurate mapping.</p></li>
</ul>
<blockquote class="blockquote">
<p>üìù <strong>Note</strong>: When climate covariates are not included in a model, random effects may capture unmeasured or unexplained drivers of seasonality (e.g., timing of the warm/rainy season) and interannual variability (e.g., El Ni√±o‚ÄìSouthern Oscillation (ENSO) events that can lead to anomalous climate patterns/extreme events)</p>
</blockquote>
<p>The following plot visualizes the estimated yearly random effects from three different models. The <code>re_id</code> argument (<code>"year_id"</code>) corresponds to the indexing variable used in the INLA model‚Äôs random effect term (in this case <code>f(year_id, ...)</code>). The <code>re_label</code> maps this ID back to the original variable in the dataset (<em>year</em>), allowing the x-axis to display readable calendar years instead of numeric IDs.</p>
<p>The plot suggests that the addition of covariates alters the contribution of the yearly random effect in accounting for interannual variability in some years. For example, in 2004 and 2018, the inclusion of climate covariates resulted in a small reduction (shift towards the null) of the contribution of the yearly random effect.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_re</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> model_list, <span class="co"># A GHRmodels object containing fitted model outputs</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="fu">c</span>(<span class="st">"mod1"</span>, <span class="st">"mod3"</span>, <span class="st">"mod5"</span>), <span class="co"># IDs of the models to compare (must match those in model_list)</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_label =</span> <span class="fu">c</span>(<span class="st">"Baseline"</span>, <span class="co"># Label for mod1: baseline model</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"tmin.l1_nl"</span>, <span class="co"># Label for mod4: includes PDSI replicated by climate</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pdsi.l1_nl + tmin.l1_nl"</span>), <span class="co"># Label for mod6: includes nonlinear effects of PDSI and Tmin</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">re_id =</span> <span class="st">"year_id"</span>,  <span class="co"># Name of the random effect variable (as defined in model structure)</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">re_label =</span> <span class="st">"year"</span>,  <span class="co"># Optional: label to map year_id to calendar years</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_color =</span> <span class="st">"grey"</span>,  <span class="co"># Color to use for the first (reference) model‚Äôs effects</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"IDE2"</span>, <span class="co"># Color palette for other model effects</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Yearly Random Effect"</span>, <span class="co"># Title for the plot</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Year"</span> <span class="co"># Label for the x-axis (since re_label maps ID to actual years)</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/plot_re yearly no replication-1.png" style="display: block; margin: auto;"></p>
<p><br> Below we produce a faceted plot of monthly random effects replicated across mesoregions, allowing for comparison of temporal variation across four models. This visualization is useful for examining how model structure influences unexplained temporal variability across regions.</p>
<blockquote class="blockquote">
<p>üí° <strong>Tip</strong>: Users can customize the variables used in the visualization by modifying the <code>GHRmodels$data</code> element. In this example we add a more descriptive month label:</p>
</blockquote>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Maps integers 1‚Äì12 to "January" through "December" using R‚Äôs built-in month.name vector</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>model_list[[<span class="st">"data"</span>]] <span class="ot">&lt;-</span> model_list[[<span class="st">"data"</span>]]<span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">month_label =</span> month.name[month_id]) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Each facet in the plot corresponds to a different mesoregion, and the plotted lines show the monthly random effects estimated by each model. The use of <code>re_id</code>, <code>rep_id</code>, and their associated label mappings (<code>re_label</code>, <code>rep_label</code>) ensures that both temporal and spatial structures are clearly presented.</p>
<p>This plot suggests that the covariates in all <em>mesoregions</em> explain a substantial portion of the seasonality (the monthly random effect values are closer to 0).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_re</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> model_list, <span class="co"># A GHRmodels object containing fitted model outputs</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="fu">c</span>(<span class="st">"mod1"</span>, <span class="st">"mod3"</span>, <span class="st">"mod5"</span>), <span class="co"># IDs of the models to compare (must match those in model_list)</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_label =</span> <span class="fu">c</span>(<span class="st">"Baseline"</span>, <span class="co"># Label for mod1: baseline model</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"tmin.l1_nl"</span>, <span class="co"># Label for mod4: includes PDSI replicated by climate</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pdsi.l1_nl + tmin.l1_nl"</span>), <span class="co"># Label for mod6: includes nonlinear effects of PDSI and Tmin</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">re_id =</span> <span class="st">"month_id"</span>, <span class="co"># Name of the random effect in the model formula (e.g., f(month_id, ...))</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">re_label =</span> <span class="st">"month_label"</span>, <span class="co"># Variable in the dataset corresponding to readable month names</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">rep_id =</span> <span class="st">"spat_meso_id"</span>, <span class="co"># Variable indicating the grouping structure (replication across meso areas)</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">rep_label =</span> <span class="st">"meso_name"</span>,<span class="co"># Variable to label facets (e.g., "Centro Norte", "Sudoeste", etc.)</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_color =</span> <span class="st">"grey"</span>, <span class="co"># Color for the reference model (first listed in mod_id)</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"IDE2"</span>, <span class="co"># Palette for coloring additional models</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Monthly random effect repeated by meso area"</span>,  <span class="co"># Plot title</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Month"</span> <span class="co"># Label for x-axis (calendar month, from re_label)</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/plot_re monthly replication-1.png" style="display: block; margin: auto;"></p>
<p><br> Here we create a <strong>caterpillar</strong> plot of the spatial random effects for four models. Each point represents the estimated effect for a microregion, with models compared side by side. The <code>re_id</code> refers to the variable used in the model to define spatial units, and <code>re_label</code> is used to map those to more interpretable labels (e.g., actual microregion names).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_re</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> model_list, <span class="co"># A GHRmodels object containing the output of fitted models</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="fu">c</span>(<span class="st">"mod1"</span>, <span class="st">"mod3"</span>, <span class="st">"mod5"</span>), <span class="co"># IDs of the models to compare (must match those in model_list)</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_label =</span> <span class="fu">c</span>(<span class="st">"Baseline"</span>, <span class="co"># Label for mod1: baseline model</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"tmin.l1_nl"</span>, <span class="co"># Label for mod4: includes PDSI replicated by climate</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pdsi.l1_nl + tmin.l1_nl"</span>), <span class="co"># Label for mod6: includes nonlinear effects of PDSI and Tmin</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">re_id =</span> <span class="st">"spat_id"</span>,  <span class="co"># Name of the spatial random effect variable as defined in the model</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">re_label =</span> <span class="st">"micro_name"</span>, <span class="co"># Optional label to map spat_id to readable microregion names </span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Spatial random effects"</span>,  <span class="co"># Title of the plot</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Micro code for spatial units"</span> <span class="co"># Label for the x-axis </span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/plot_re spatial no map-1.png" style="display: block; margin: auto;"></p>
<p><br></p>
<p>This version of <code>plot_re()</code> displays spatial random effects on a map, using the polygon geometries provided in the <code>map_MS</code> object. The <code>map_area</code> argument must match the name of the variable in the <code>sf</code> object (<code>map_MS</code>) that corresponds to the <code>re_id</code> used in the model (here, <em>spat_id</em> in the data matches to <em>code</em> in the <code>sf</code> object).</p>
<p>The resulting plot shows the median of the posterior distribution of the random effect per area, allowing users to visually assess spatial patterns in unexplained variability across the study region. Each facet (if multiple models are used) displays how spatial structure changes based on model specification.</p>
<p>Here we observe that, in some areas, the inclusion of climate covariates in the model do not change the contribution of the spatial random effect, suggesting they are accounting for other sources of overdispersion or spatial autocorrelation (e.g., variation in interventions). In some microregions (e.g.&nbsp;the southernmost microregion), the inclusion of climate covariates in the model leads to a reduction in the contribution of the spatial effect, suggesting the climate may help understand some of the spatial variation in disease risk in this area.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_re</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> model_list, <span class="co"># A GHRmodels object containing the output of fitted models</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="fu">c</span>(<span class="st">"mod1"</span>, <span class="st">"mod3"</span>, <span class="st">"mod5"</span>), <span class="co"># IDs of the models to compare (must match those in model_list)</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_label =</span> <span class="fu">c</span>(<span class="st">"Baseline"</span>, <span class="co"># Label for mod1: baseline model</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"tmin.l1_nl"</span>, <span class="co"># Label for mod4: includes PDSI replicated by climate</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pdsi.l1_nl + tmin.l1_nl"</span>), <span class="co"># Label for mod6: includes nonlinear effects of PDSI and Tmin</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">re_id =</span> <span class="st">"spat_id"</span>, <span class="co"># Name of the spatial random effect variable used in model</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">re_label =</span> <span class="st">"micro_name"</span>, <span class="co"># Variable used to map IDs to readable names</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">map =</span> map_MS, <span class="co"># An sf object with polygon boundaries for plotting</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">map_area =</span> <span class="st">"code"</span>, <span class="co"># Name of the column in map_MS that matches spat_id in the model</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Spatial random effects"</span>, <span class="co"># Title for the spatial plot</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="st">"Median of the </span><span class="sc">\n</span><span class="st">random effect ppd"</span> <span class="co"># Title for the legend</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/plot_re spatial map-1.png" style="display: block; margin: auto;"></p>
</section>
</section>
<section id="iterative-model-selection" class="level2">
<h2 class="anchored" data-anchor-id="iterative-model-selection">4. Iterative model selection</h2>
<p>Iterative model selection for inference or prediction often involves stepwise addition of covariates, followed by evaluating how each new covariate affects both the outcome and overall model fit. The <strong>GHRmodel</strong> helper functions (<code>subset_models()</code>, <code>stack_models()</code>, <code>get_covariates()</code>, and <code>cov_add()</code>), together with the model evaluation functions, streamline this process. Below, we present a simple example illustrating how such an iterative workflow might be implemented in our case study:</p>
<section id="subset-models" class="level3">
<h3 class="anchored" data-anchor-id="subset-models">Subset models</h3>
<p>Use <code>subset_models()</code> to subset selected models from a <code>GHRmodels</code> object into a new reduced <code>GHRmodels</code> object. If new_name is supplied, it will prefix the new model IDs (e.g., <code>"best_waic_1"</code>, <code>"best_waic_2"</code>).</p>
<p>Here we use the vector produced using <code>rank_models</code> to subset the <em>model_list</em> <code>GHRmodels</code> object into an object with only the 2 best ranking WAIC models:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract a vector with the model IDs of the 2 best fitting models by WAIC</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>best_waic <span class="ot">&lt;-</span> <span class="fu">rank_models</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> model_list,  <span class="co"># GHRmodels object containing model fit results</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"waic"</span>,      <span class="co"># Metric used to rank models (lower WAIC is better)</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">2</span>                 <span class="co"># Number of top-ranked models to return</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The output is a vector </span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>best_waic</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "mod5" "mod3"</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset those specific models and assign new IDs</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>model_waic <span class="ot">&lt;-</span> <span class="fu">subset_models</span>(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> model_list,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> best_waic,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_name =</span> <span class="st">"best_waic"</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co"># The output is a reduced GHRmodels object</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(model_waic)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "GHRmodels" "list"</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the model IDs of the subset GHRmodels object</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(model_waic<span class="sc">$</span>mod_gof<span class="sc">$</span>model_id) </span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "best_waic1" "best_waic2"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="extract-covariates" class="level3">
<h3 class="anchored" data-anchor-id="extract-covariates">Extract covariates</h3>
<p>Use <code>get_covariates()</code> to inspect which covariates were included in your fitted models. You can choose to retrieve:</p>
<ul>
<li><p>All covariate combinations as specified in each model by setting <code>unique = FALSE</code>. This preserves the exact combinations used in each model.</p></li>
<li><p>A list of unique covariate terms by setting <code>unique = TRUE</code>. This shows each covariate only once, regardless of how many models it appears in.</p></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all covariate combinations as declared in the best-fitting models</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>best_waic_cov <span class="ot">&lt;-</span> <span class="fu">get_covariates</span>(<span class="at">model =</span> model_waic, <span class="at">unique =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize covariate combinations </span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>best_waic_cov</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(tmin.l1, method = 'quantile', n = 10), model = 'rw2')"</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(pdsi.l1, method = 'quantile', n = 10), model = 'rw2')"</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] "f(INLA::inla.group(tmin.l1, method = 'quantile', n = 10), model = 'rw2')"</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all unique covariates across the best-fitting models</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>best_waic_cov_unique <span class="ot">&lt;-</span> <span class="fu">get_covariates</span>(<span class="at">model =</span> model_waic, <span class="at">unique =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize unique covariates </span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>best_waic_cov_unique</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(tmin.l1, method = 'quantile', n = 10), model = 'rw2')"</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(pdsi.l1, method = 'quantile', n = 10), model = 'rw2')"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="add-an-additional-covariate" class="level3">
<h3 class="anchored" data-anchor-id="add-an-additional-covariate">Add an additional covariate</h3>
<p>The <code>cov_add()</code> function appends one or more covariate names to each set of covariates in a list.</p>
<p>Here we add the covariate <em>urban</em> to the covariates of the best fitting models:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>best_waic_cov_urban <span class="ot">&lt;-</span> <span class="fu">cov_add</span>(best_waic_cov, <span class="at">name=</span> <span class="st">"urban"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(best_waic_cov_urban)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(tmin.l1, method = 'quantile', n = 10), model = 'rw2')"</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] "urban"                                                                   </span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(pdsi.l1, method = 'quantile', n = 10), model = 'rw2')"</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] "f(INLA::inla.group(tmin.l1, method = 'quantile', n = 10), model = 'rw2')"</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3] "urban"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Next, we generate a new set of model formulas by converting the covariate list including <em>urban</em> into a standardized formula structure using <code>write_inla_formulas()</code> and converting into a <code>GHRformulas</code> object using <code>as_GHRformulas()</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a list of INLA-compatible model formulas including outcome, covariates, and random effects</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>formulas_cov_urban_list <span class="ot">&lt;-</span> <span class="fu">write_inla_formulas</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Outcome (dependent variable) in all formulas</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"dengue_cases"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># List of covariate sets to be included in the formulas (generated earlier as cov_list)</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">covariates =</span> best_waic_cov_urban ,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First random effect: monthly seasonality</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">re1 =</span> <span class="fu">list</span>(</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">id        =</span> <span class="st">"month_id"</span>,      <span class="co"># Time index for monthly effect</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">model     =</span> <span class="st">"rw1"</span>,           <span class="co"># First-order random walk model</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cyclic    =</span> <span class="cn">TRUE</span>,            <span class="co"># Enforce cyclicity over months (Dec ‚Üí Jan wrap-around)</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper     =</span> <span class="st">"prior_t"</span>,       <span class="co"># Hyperprior object for precision</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">replicate =</span> <span class="st">"spat_meso_id"</span>   <span class="co"># Separate seasonal pattern per mesoregion</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Second random effect: inter-annual trend</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">re2 =</span> <span class="fu">list</span>(</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">id    =</span> <span class="st">"year_id"</span>,           <span class="co"># Year index</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">"rw1"</span>,               <span class="co"># First-order random walk model</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper =</span> <span class="st">"prior_t"</span>            <span class="co"># Hyperprior for temporal smoothness</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Third random effect: spatial autocorrelation</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">re3 =</span> <span class="fu">list</span>(</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">id    =</span> <span class="st">"spat_id"</span>,           <span class="co"># Spatial unit identifier</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">"bym2"</span>,              <span class="co"># BYM2 spatial model (structured + unstructured)</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph =</span> <span class="st">"g"</span>,                 <span class="co"># Pre-computed spatial adjacency graph</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper =</span> <span class="st">"prior_sp"</span>           <span class="co"># PC priors for BYM2 model parameters</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Include a baseline random effect-only model formula as 1st element in the list</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline =</span> <span class="cn">TRUE</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert into a GHRformulas object </span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>formulas_cov_urban_list_ghr <span class="ot">&lt;-</span> <span class="fu">as_GHRformulas</span>(<span class="at">formulas =</span> formulas_cov_urban_list)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="fit-new-models" class="level3">
<h3 class="anchored" data-anchor-id="fit-new-models">Fit new models</h3>
<p>Then we can fit the models to assess the added effect of <em>urban</em> on dengue cases:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>model_urban_list <span class="ot">&lt;-</span> <span class="fu">fit_models</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formulas =</span> formulas_cov_urban_list_ghr, <span class="co"># GHRformulas object</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,                      <span class="co"># Data to fit the models </span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"nbinomial"</span>,             <span class="co"># Negative binomial likelihood</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"mod"</span>,                     <span class="co"># Label prefix for each model</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="st">"population"</span>,            <span class="co"># Offset variable to account for population size</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control_compute =</span> <span class="fu">list</span>(</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">config =</span> <span class="cn">FALSE</span>,                 <span class="co"># Do not posterior predictive distribution</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">vcov =</span> <span class="cn">FALSE</span>                    <span class="co"># Do not return variance-covariance matrix</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">nthreads =</span> <span class="dv">8</span>                      <span class="co"># Use 8 threads for parallel computation</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="combine-models" class="level3">
<h3 class="anchored" data-anchor-id="combine-models">Combine models</h3>
<p>Use <code>stack_models()</code> (or <code>merge_models()</code>) to merge two or more <code>GHRmodels</code> objects into one. This is particularly useful when comparing batches of models fitted with different modeling strategies. Currently it only supports sets of models sharing the same random effect structure. If any <code>mod_id</code>s are duplicated across models, <code>new_name</code> must be provided to ensure unique IDs.</p>
<p>Here we combine the <code>GHRmodel</code> objects with the <em>urban</em> covariate to the best-fitting models without the <em>urban</em> covariate to compare fit:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge models from different objects</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>model_stack <span class="ot">&lt;-</span> <span class="fu">stack_models</span>(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  model_waic,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  model_urban_list,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_name =</span> <span class="st">"mod"</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The combined model_stack combines the best fitting models by WAIC and those including the urban covariate</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>model_stack<span class="sc">$</span>mod_gof<span class="sc">$</span>model_id  </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "best_waic1" "best_waic2" "mod1"       "mod2"       "mod3"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="evaluate-combined-models" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-combined-models">Evaluate combined models</h3>
<p>Using the <code>rank_models()</code> and <code>plot_gof()</code> we observe that adding the <em>urban</em> covariate does not improve the model fit by WAIC compared to models that only have 1-month lag terms for mean minimum temperature and PDSI.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rank_models</span>(model_stack, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">metric =</span> <span class="st">"waic"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "best_waic2" "best_waic1" "mod2"       "mod3"       "mod1"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a variable to the mod_gof dataframe to distinguish models with the urban covariate</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>model_stack_gof  <span class="ot">&lt;-</span> model_stack<span class="sc">$</span>mod_gof <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Add urban</span><span class="st">`</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"urban"</span>, covariate_3, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">|</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">grepl</span>(<span class="st">"urban"</span>, covariate_2, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="st">"yes"</span>, </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(covariate_3) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"no"</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    ))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot change in WAIC for each model compared to the baseline (first model in the list)</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_gof</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_gof =</span> model_stack_gof,           <span class="co"># Goodness-of-fit data from model_list</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"waic"</span>,                     <span class="co"># Compare WAIC </span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ci =</span> <span class="cn">TRUE</span>,                           <span class="co"># Include credible intervals (if available)</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_arrange =</span> <span class="st">"waic"</span>,                <span class="co"># Arrange models by WAIC </span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_color =</span>  <span class="st">"Add urban"</span>, </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_label =</span> <span class="fu">c</span>(</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod1"</span> <span class="ot">=</span> <span class="st">"Baseline"</span>,                 </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod2"</span> <span class="ot">=</span> <span class="st">"tmin.l1_nl + urban"</span>,      </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod3"</span> <span class="ot">=</span> <span class="st">"tmin.l1_nl + pdsi.l1_nl + urban"</span>, </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"best_waic1"</span> <span class="ot">=</span> <span class="st">"tmin.l1_nl"</span>, </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"best_waic2"</span> <span class="ot">=</span> <span class="st">"tmin.l1_nl + pdsi.l1_nl"</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/plot_gof model_stack-1.png" style="display: block; margin: auto;"></p>
<p>We also observe that the 95% credible interval of the effect of <em>urban</em> on the outcome (<em>dengue cases</em>) contains zero.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coef_lin</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> model_stack,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Effects of linear covariates"</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_overview_files/figure-gfm/pot_coef_lin model stack-1.png" style="display: block; margin: auto;"></p>
<p>These results point against including <em>urban</em> as a linear covariate in the final model.</p>
</section>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-besag_bayesian_1991" class="csl-entry" role="listitem">
Besag, J., York, J., &amp; Molli√©, A. (1991). Bayesian image restoration, with two applications in spatial statistics. <em>Annals of the Institute of Statistical Mathematics</em>, <em>43</em>(1), 1‚Äì20. <a href="https://doi.org/10.1007/BF00116466" class="uri">https://doi.org/10.1007/BF00116466</a>
</div>
<div id="ref-fletcher_compound_2025" class="csl-entry" role="listitem">
Fletcher, C., Moirano, G., Alcayna, T., Rollock, L., Van Meerbeeck, C. J., Mahon, R., Trotman, A., Boodram, L.-L., Browne, T., Best, S., L√ºhrsen, D., Diaz, A. R., Dunbar, W., Lippi, C. A., Ryan, S. J., Col√≥n-Gonz√°lez, F. J., Stewart-Ibarra, A. M., &amp; Lowe, R. (2025). Compound and cascading effects of climatic extremes on dengue outbreak risk in the Caribbean: An impact-based modelling framework with long-lag and short-lag interactions. <em>The Lancet Planetary Health</em>, <em>9</em>(8), 101279. <a href="https://doi.org/10.1016/j.lanplh.2025.06.003" class="uri">https://doi.org/10.1016/j.lanplh.2025.06.003</a>
</div>
<div id="ref-gelman_data_2006" class="csl-entry" role="listitem">
Gelman, A., &amp; Hill, J. (2006). Data Analysis Using Regression and Multilevel/Hierarchical Models. In <em>Cambridge Aspire website</em>. <a href="https://doi.org/10.1017/CBO9780511790942" class="uri">https://doi.org/10.1017/CBO9780511790942</a>
</div>
<div id="ref-gomez-rubio_bayesian_2020" class="csl-entry" role="listitem">
G√≥mez-Rubio, V. (2020). <em>Bayesian inference with INLA</em>. Chapman &amp;Hall/CRC Press. <a href="https://becarioprecario.bitbucket.io/inla-gitbook/index.html" class="uri">https://becarioprecario.bitbucket.io/inla-gitbook/index.html</a>
</div>
<div id="ref-lindgren_explicit_2011" class="csl-entry" role="listitem">
Lindgren, F., Rue, H., &amp; Lindstr√∂m, J. (2011). An Explicit Link between Gaussian Fields and Gaussian Markov Random Fields: The Stochastic Partial Differential Equation Approach. <em>Journal of the Royal Statistical Society Series B: Statistical Methodology</em>, <em>73</em>(4), 423‚Äì498. <a href="https://doi.org/10.1111/j.1467-9868.2011.00777.x" class="uri">https://doi.org/10.1111/j.1467-9868.2011.00777.x</a>
</div>
<div id="ref-lowe_nonlinear_2018" class="csl-entry" role="listitem">
Lowe, R., Gasparrini, A., Van Meerbeeck, C. J., Lippi, C. A., Mahon, R., Trotman, A. R., Rollock, L., Hinds, A. Q. J., Ryan, S. J., &amp; Stewart-Ibarra, A. M. (2018). Nonlinear and delayed impacts of climate on dengue risk in Barbados: A modelling study. <em>PLOS Medicine</em>, <em>15</em>(7), e1002613. <a href="https://doi.org/10.1371/journal.pmed.1002613" class="uri">https://doi.org/10.1371/journal.pmed.1002613</a>
</div>
<div id="ref-lowe_combined_2021" class="csl-entry" role="listitem">
Lowe, R., Lee, S. A., O‚ÄôReilly, K. M., Brady, O. J., Bastos, L., Carrasco-Escobar, G., De Castro Cat√£o, R., Col√≥n-Gonz√°lez, F. J., Barcellos, C., Carvalho, M. S., Blangiardo, M., Rue, H., &amp; Gasparrini, A. (2021). Combined effects of hydrometeorological hazards and urbanisation on dengue risk in Brazil: A spatiotemporal modelling study. <em>The Lancet Planetary Health</em>, <em>5</em>(4), e209‚Äìe219. <a href="https://doi.org/10.1016/S2542-5196(20)30292-8" class="uri">https://doi.org/10.1016/S2542-5196(20)30292-8</a>
</div>
<div id="ref-mcelreath_statistical_2020" class="csl-entry" role="listitem">
McElreath, R. (2020). <em>Statistical Rethinking: A Bayesian Course with Examples in R and STAN</em> (2nd ed.). Chapman; Hall/CRC. <a href="https://doi.org/10.1201/9780429029608" class="uri">https://doi.org/10.1201/9780429029608</a>
</div>
<div id="ref-moraga_geospatial_2019" class="csl-entry" role="listitem">
Moraga, P. (2019). <em>Geospatial Health Data: Modeling and Visualization with R-INLA and Shiny</em>. Chapman &amp; Hall/CRC Biostatistics Series. <a href="https://www.paulamoraga.com/book-geospatial/index.html" class="uri">https://www.paulamoraga.com/book-geospatial/index.html</a>
</div>
<div id="ref-rue_approximate_2009" class="csl-entry" role="listitem">
Rue, H., Martino, S., &amp; Chopin, N. (2009). Approximate Bayesian inference for latent Gaussian models by using integrated nested Laplace approximations. <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em>, <em>71</em>(2), 319‚Äì392. <a href="https://doi.org/10.1111/j.1467-9868.2008.00700.x" class="uri">https://doi.org/10.1111/j.1467-9868.2008.00700.x</a>
</div>
<div id="ref-rue_bayesian_2017" class="csl-entry" role="listitem">
Rue, H., Riebler, A., S√∏rbye, S. H., Illian, J. B., Simpson, D. P., &amp; Lindgren, F. K. (2017). Bayesian Computing with INLA: A Review. <em>Annual Review of Statistics and Its Application</em>, <em>4</em>(1), 395‚Äì421. <a href="https://doi.org/10.1146/annurev-statistics-060116-054045" class="uri">https://doi.org/10.1146/annurev-statistics-060116-054045</a>
</div>
<div id="ref-simpson_penalising_2017" class="csl-entry" role="listitem">
Simpson, D., Rue, H., Riebler, A., Martins, T. G., &amp; S√∏rbye, S. H. (2017). Penalising Model Component Complexity: A Principled, Practical Approach to Constructing Priors. <em>Statistical Science</em>, <em>32</em>(1). <a href="https://doi.org/10.1214/16-STS576" class="uri">https://doi.org/10.1214/16-STS576</a>
</div>
<div id="ref-van_de_schoot_gentle_2014" class="csl-entry" role="listitem">
Van De Schoot, R., Kaplan, D., Denissen, J., Asendorpf, J. B., Neyer, F. J., &amp; Van Aken, M. A. G. (2014). A Gentle Introduction to Bayesian Analysis: Applications to Developmental Research. <em>Child Development</em>, <em>85</em>(3), 842‚Äì860. <a href="https://doi.org/10.1111/cdev.12169" class="uri">https://doi.org/10.1111/cdev.12169</a>
</div>
</div>


</section>

</span></span></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/BSC-ES\.github\.io\/GHRtools\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, GHR</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>