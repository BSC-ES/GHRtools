<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Complex Covariate Structures in GHRmodel – GHRtools</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../figures/bsc-logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-81db3bc9543b97ff6e1d188ef868d7e2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">GHRtools</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data4health" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">data4health</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data4health">    
        <li>
    <a class="dropdown-item" href="../../docs/data4health/data4health.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-clim4health" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">clim4health</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-clim4health">    
        <li>
    <a class="dropdown-item" href="../../docs/clim4health/clim4health.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ghrexplore" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">GHRexplore</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ghrexplore">    
        <li>
    <a class="dropdown-item" href="../../docs/GHRexplore/GHRexplore.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/GHRexplore/GHRexplore-index.html">
 <span class="dropdown-text">Reference</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/GHRexplore/GHRexplore-news.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Vignettes</li>
        <li>
    <a class="dropdown-item" href="../../docs/GHRexplore/GHRexplore-vignette.html">
 <span class="dropdown-text">Getting started</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ghrmodel" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">GHRmodel</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ghrmodel">    
        <li>
    <a class="dropdown-item" href="../../docs/GHRmodel/GHRmodel.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/GHRmodel/GHRmodel-index.html">
 <span class="dropdown-text">Reference</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/GHRmodel/GHRmodel-news.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Vignettes</li>
        <li>
    <a class="dropdown-item" href="../../docs/GHRmodel/GHRmodel_overview.html">
 <span class="dropdown-text">Getting started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/GHRmodel/GHRmodel_covariates.html">
 <span class="dropdown-text">Covariate structures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/GHRmodel/GHRmodel_DLNM.html">
 <span class="dropdown-text">DLNMs in GHRmodel</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ghrpredict" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">GHRpredict</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ghrpredict">    
        <li>
    <a class="dropdown-item" href="../../docs/GHRpredict/GHRpredict.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://www.bsc.es/discover-bsc/organisation/research-departments/global-health-resilience" target="_blank"> 
<span class="menu-text">About GHR</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#ghrmodel-formula-helper-functions" id="toc-ghrmodel-formula-helper-functions" class="nav-link" data-scroll-target="#ghrmodel-formula-helper-functions">GHRmodel formula helper functions</a></li>
  </ul></li>
  <li><a href="#prepare-data" id="toc-prepare-data" class="nav-link" data-scroll-target="#prepare-data">0. Prepare data</a>
  <ul class="collapse">
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries">Load libraries</a></li>
  <li><a href="#data-pre-processing" id="toc-data-pre-processing" class="nav-link" data-scroll-target="#data-pre-processing">Data pre-processing</a></li>
  <li><a href="#spatial-data-and-graphs" id="toc-spatial-data-and-graphs" class="nav-link" data-scroll-target="#spatial-data-and-graphs">Spatial data and graphs</a></li>
  <li><a href="#pre-process-covariates" id="toc-pre-process-covariates" class="nav-link" data-scroll-target="#pre-process-covariates">Pre-process covariates</a></li>
  <li><a href="#lagged-covariates" id="toc-lagged-covariates" class="nav-link" data-scroll-target="#lagged-covariates">Lagged covariates</a></li>
  <li><a href="#define-priors" id="toc-define-priors" class="nav-link" data-scroll-target="#define-priors">Define priors</a></li>
  </ul></li>
  <li><a href="#example-1-ghrmodel-helper-functions" id="toc-example-1-ghrmodel-helper-functions" class="nav-link" data-scroll-target="#example-1-ghrmodel-helper-functions">Example 1: GHRmodel helper functions</a>
  <ul class="collapse">
  <li><a href="#model-development" id="toc-model-development" class="nav-link" data-scroll-target="#model-development">1. Model development</a>
  <ul class="collapse">
  <li><a href="#select-variables" id="toc-select-variables" class="nav-link" data-scroll-target="#select-variables">Select variables</a></li>
  <li><a href="#linear-covariates" id="toc-linear-covariates" class="nav-link" data-scroll-target="#linear-covariates">Linear covariates</a></li>
  <li><a href="#non-linear-covariates" id="toc-non-linear-covariates" class="nav-link" data-scroll-target="#non-linear-covariates">Non-linear covariates</a></li>
  <li><a href="#non-linear-covariates-replicated-by-group" id="toc-non-linear-covariates-replicated-by-group" class="nav-link" data-scroll-target="#non-linear-covariates-replicated-by-group">Non-linear covariates replicated by group</a></li>
  <li><a href="#covariates-for-multivariate-models" id="toc-covariates-for-multivariate-models" class="nav-link" data-scroll-target="#covariates-for-multivariate-models">Covariates for multivariate models</a></li>
  <li><a href="#add-a-covariate-to-all-covariate-lists" id="toc-add-a-covariate-to-all-covariate-lists" class="nav-link" data-scroll-target="#add-a-covariate-to-all-covariate-lists">Add a covariate to all covariate lists</a></li>
  <li><a href="#interacting-covariates" id="toc-interacting-covariates" class="nav-link" data-scroll-target="#interacting-covariates">Interacting covariates</a></li>
  <li><a href="#varying-covariates" id="toc-varying-covariates" class="nav-link" data-scroll-target="#varying-covariates">Varying covariates</a></li>
  <li><a href="#varying-vs.-replicated-effects-in-inla" id="toc-varying-vs.-replicated-effects-in-inla" class="nav-link" data-scroll-target="#varying-vs.-replicated-effects-in-inla">Varying vs.&nbsp;Replicated Effects in INLA</a></li>
  <li><a href="#write-inla-compatible-model-formulas" id="toc-write-inla-compatible-model-formulas" class="nav-link" data-scroll-target="#write-inla-compatible-model-formulas">Write INLA-compatible model formulas</a></li>
  </ul></li>
  <li><a href="#model-fitting" id="toc-model-fitting" class="nav-link" data-scroll-target="#model-fitting">2. Model fitting</a></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">3. Model evaluation</a>
  <ul class="collapse">
  <li><a href="#interaction-effects" id="toc-interaction-effects" class="nav-link" data-scroll-target="#interaction-effects">Interaction effects</a></li>
  <li><a href="#varying-linear-coefficients" id="toc-varying-linear-coefficients" class="nav-link" data-scroll-target="#varying-linear-coefficients">Varying linear coefficients</a></li>
  <li><a href="#replicated-nonlinear-coefficients" id="toc-replicated-nonlinear-coefficients" class="nav-link" data-scroll-target="#replicated-nonlinear-coefficients">Replicated nonlinear coefficients</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#example-2-inla-compatible-formulas" id="toc-example-2-inla-compatible-formulas" class="nav-link" data-scroll-target="#example-2-inla-compatible-formulas">Example 2: INLA-compatible formulas</a>
  <ul class="collapse">
  <li><a href="#model-development-1" id="toc-model-development-1" class="nav-link" data-scroll-target="#model-development-1">1. Model development</a></li>
  <li><a href="#model-fitting-1" id="toc-model-fitting-1" class="nav-link" data-scroll-target="#model-fitting-1">2. Model fitting</a></li>
  <li><a href="#model-evaluation-1" id="toc-model-evaluation-1" class="nav-link" data-scroll-target="#model-evaluation-1">3. Model evaluation</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Complex Covariate Structures in GHRmodel</h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<!-- badges: start -->
<p><a href="http://www.gnu.org/licenses/gpl-2.0.html"><img src="http://img.shields.io/badge/license-GPL%20%28%3E=%202%29-brightgreen.svg?style=flat" class="img-fluid" alt="License"></a> <a href="https://cran.r-project.org/package=GHRmodel"><img src="https://img.shields.io/cran/v/GHRmodel.png" class="img-fluid" alt="CRAN status"></a> <!-- badges: end --></p>
<img src="../../figures/GHRexplore/logo_IDExtremes.jpg" align="right" width="18%"> <span> <span> <img src="../../figures/GHRexplore/logo_BSC.png" align="right" width="16%"> 
<style>
div.csl-bib-body {
  font-size: 0.9em;         /* smaller font */
}
div.csl-entry {
  margin-bottom: 0.6em;     /* add space between references */
}
</style>
<section id="overview" class="level1">
<h1>Overview</h1>
<p>The <em>GHRmodel_covariates</em> vignette shows how to create INLA-compatible formulas for complex Bayesian spatio-temporal models (including interactions, varying and replicated effects). Models are then fitted using integrated nested Laplace approximations in R (<a href="https://www.r-inla.org/home">R-INLA</a>) (Lindgren et al., 2011).</p>
<p>This vignette covers:</p>
<ul>
<li><p>An overview of <strong>GHRmodel</strong> helper functions for creating INLA-ready model formulas.</p></li>
<li><p>Example 1: A worked example of model development, fitting, and evaluation using <strong>GHRmodel</strong> covariate helper functions.</p></li>
<li><p>Example 2: An example illustrating how to fit and evaluate models from user-specified INLA formulas.</p></li>
</ul>
<blockquote class="blockquote">
<p>📝 <strong>Note</strong>: The examples in this vignette are designed to demonstrate package functionality and should not be interpreted as best-practice guidance for model selection.</p>
</blockquote>
<div class="figure" style="text-align: center">
<img src="https://gitlab.earth.bsc.es/ghr/ghrmodel/-/raw/510e4737684359badce248d83a9113be8a3b976f/inst/images/GHRmodel_structure.png" alt="**GHRmodel** functions to streamline INLA-compatible model formula development." width="100%">
<p class="caption">
<strong>GHRmodel</strong> functions to streamline INLA-compatible model formula development.
</p>
</div>
<p><br> Information regarding installation and a brief summary of the package methodology is included in the vignette <em>GHRmodel Overview</em>, which can be accessed by typing <code>vignette("GHRmodel_overview")</code>.</p>
<section id="ghrmodel-formula-helper-functions" class="level2">
<h2 class="anchored" data-anchor-id="ghrmodel-formula-helper-functions">GHRmodel formula helper functions</h2>
<p>Model formulas in INLA follow a specific structure. The functions below streamline their construction by generating organized lists of INLA-compatible covariate terms.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Function</th>
<th style="text-align: left;">Purpose</th>
<th style="text-align: left;">Input</th>
<th style="text-align: left;">Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>extract_names()</code></td>
<td style="text-align: left;">Selects covariate names from a dataset</td>
<td style="text-align: left;">Data frame</td>
<td style="text-align: left;">Character vector</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>cov_uni()</code></td>
<td style="text-align: left;">Prepares covariates for univariable INLA models</td>
<td style="text-align: left;">Character vector</td>
<td style="text-align: left;">List of linear covariates</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>cov_multi()</code></td>
<td style="text-align: left;">Generates combinations of covariates for multivariable models.</td>
<td style="text-align: left;">Character vector or a list of character vectors</td>
<td style="text-align: left;">List with INLA nonlinear effect terms</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>cov_nl()</code></td>
<td style="text-align: left;">Convert covariates to nonlinear effect terms, with optional replication.</td>
<td style="text-align: left;">Character vector or a list of character vectors</td>
<td style="text-align: left;">List of multivariable covariate sets</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>cov_interact()</code></td>
<td style="text-align: left;">Creates interaction terms between 2 or 3 covariates (e.g., var1:var2).</td>
<td style="text-align: left;">List of character vectors</td>
<td style="text-align: left;">List including interaction terms</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>cov_varying()</code></td>
<td style="text-align: left;">Creates spatially or temporally varying effect terms using INLA’s f() structure.</td>
<td style="text-align: left;">Character vector or a list of character vectors</td>
<td style="text-align: left;">List including spatially/temporally varying terms</td>
</tr>
</tbody>
</table>
<p>Overview of helper functions to prepare covariate lists for INLA-compatible formulas.</p>
<p>After extracting the potential covariate names from the dataset using <code>extract_names()</code>, functions with the prefix <code>cov_*</code> allow the user to generate lists of covariates to simplify building valid INLA formulas. These functions allow the user to include lagged, nonlinear or more complex covariate structures. Across all of these functions, a common structure is used:</p>
<p><strong>Input</strong>: For functions with the prefix <code>cov_*</code>, the input is a character vector and/or a list of character vectors representing covariate names specified in the <code>covariate</code> argument, with the exception of the <code>extract_names()</code> function, which accepts a data frame as input. The table above summarizes the required input type for each function.</p>
<p><strong>Covariate selection</strong> is done using the arguments:</p>
<ul>
<li><p><code>pattern</code>: for partial string matching, selecting groups of covariates that share a common prefix (e.g., “tmin” would match “tmin.l1”, “tmin.l2”, etc.).</p></li>
<li><p><code>name</code>: for exact matching of covariate names</p></li>
</ul>
<p><strong>Output</strong>: is a list of covariates that may be combined or transformed, formatted for INLA formulas. The exception is the <code>extract_names()</code> function, where the output is a character vector.</p>
<ul>
<li><code>add</code>: is a logical flag indicating whether to retain original covariates in addition to transformed or combined ones in the output.</li>
</ul>
<p>Moving forward, only arguments specific to each function will be described.</p>
</section>
</section>
<section id="prepare-data" class="level1">
<h1>0. Prepare data</h1>
<p>The example dataset contains monthly counts of notified dengue cases by microregion, along with a range of spatial and spatiotemporal covariates. This dataset represents a subset of a larger national dataset that covers the entire territory of Brazil. The subset focuses on a specific region, <em>Mato Grosso do Sul</em>, for the purposes of illustration and computational efficiency. The original full data set, which includes data from all Brazilian microregions, is available within this <a href="https://github.com/drrachellowe/hydromet_dengue">GitHub repository</a> and in <a href="https://doi.org/10.5281/zenodo.4632205">Zenodo</a>.</p>
<section id="load-libraries" class="level2">
<h2 class="anchored" data-anchor-id="load-libraries">Load libraries</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary package dependencies</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)        <span class="co"># Data manipulation</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)        <span class="co"># Data tidying</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyselect)   <span class="co"># Helpers for selecting variables programmatically</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)        <span class="co"># Tools for tidy evaluation and non-standard evaluation in tidyverse code</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)      <span class="co"># Data visualization: creating plots and graphs</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)      <span class="co"># Combining and arranging multiple ggplot2 plots into a single figure</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grDevices)    <span class="co"># Base R graphics device functions (e.g., color palettes, saving plots)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) <span class="co"># Predefined color palettes for plots</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorspace)   <span class="co"># Advanced color space manipulation and palettes</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)           <span class="co"># Handling spatial vector data (simple features)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)        <span class="co"># Spatial dependence and autocorrelation analysis</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sn)           <span class="co"># Skew-normal and skew-t distributions (for modeling skewed data)</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(INLA)         <span class="co"># Integrated Nested Laplace Approximation for Bayesian models</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GHRexplore)   <span class="co"># Exploratory analysis of health data</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Load GHRmodel</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GHRmodel)     </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="data-pre-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-pre-processing">Data pre-processing</h2>
<p>Create numeric ID variables for categorical features (such as year, month, or spatial units) that may be included as random effects, in line with R-INLA’s requirements:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load data </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"dengue_MS"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> dengue_MS</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create ID variables</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span>  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out the year 2000 </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">2000</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create numeric IDs for year, month and various spatial units.</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_id =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(year)),                <span class="co"># year numeric ID</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_id2 =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(year)),               <span class="co"># year second numeric ID</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_id =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(month)),              <span class="co"># month numeric ID</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">spat_id =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(micro_code)),          <span class="co"># microregion numeric ID</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">spat_meso_id =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(meso_code)),      <span class="co"># meso-region numeric ID</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">main_climate_f =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(main_climate))  <span class="co"># climate zone numeric ID</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="spatial-data-and-graphs" class="level2">
<h2 class="anchored" data-anchor-id="spatial-data-and-graphs">Spatial data and graphs</h2>
<p>To perform spatial analysis, polygon geometries must be provided as an <code>sf</code> object. For the <code>dengue_MS</code> data set, the areal polygons are already included in the package in the <code>map_MS</code> object. In <code>map_MS</code>, the <em>code</em> variable corresponds to the <em>micro_code</em> area identifier in the <code>dengue_MS</code> object.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load map included in package</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"map_MS"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create adjacency Matrix</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">poly2nb</span>(map_MS)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nb2mat</span>(nb, <span class="at">style =</span> <span class="st">"B"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="pre-process-covariates" class="level2">
<h2 class="anchored" data-anchor-id="pre-process-covariates">Pre-process covariates</h2>
</section>
<section id="lagged-covariates" class="level2">
<h2 class="anchored" data-anchor-id="lagged-covariates">Lagged covariates</h2>
<p>Here, we use <code>lag_cov()</code> to generate lagged values for the variables <em>tmin</em> (monthly average daily minimum temperature averaged across each micro-region) and <em>pdsi</em> (Self-calibrated Palmer Drought Severity Index for each micro-region) across 1- to 6-month lags using the <code>lag_cov()</code> function.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">lag_cov</span>(<span class="at">data =</span> df,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"tmin"</span>, <span class="st">"pdsi"</span>),  <span class="co"># variables to lag </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">time =</span> <span class="st">"date"</span>,             <span class="co"># time variable </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">lag =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),              <span class="co"># 1 to 6-month lags</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> <span class="st">"micro_code"</span>,      <span class="co"># identify spatial units with independent time series</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">add =</span> <span class="cn">TRUE</span>)                <span class="co"># lagged variables appended to original data</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize lagged variables</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data[<span class="dv">34</span><span class="sc">:</span><span class="dv">39</span>])</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   tmin.l1 tmin.l2 tmin.l3 tmin.l4 tmin.l5 tmin.l6</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    NA      NA      NA      NA      NA        NA</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2    23.5    NA      NA      NA      NA        NA</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3    23.3    23.5    NA      NA      NA        NA</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4    22.7    23.3    23.5    NA      NA        NA</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5    21.9    22.7    23.3    23.5    NA        NA</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6    17.8    21.9    22.7    23.3    23.5      NA</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="define-priors" class="level2">
<h2 class="anchored" data-anchor-id="define-priors">Define priors</h2>
<p>Bayesian models require priors to be assigned to parameters that the model will estimate. For more details regarding these prior choices, see <em>GHRmodel_overview</em>. For more details about priors in R-INLA, see <a href="https://becarioprecario.bitbucket.io/inla-gitbook/ch-priors.html">this book chapter</a> (Gómez-Rubio, 2020).</p>
<p>The monthly and yearly random effects are assigned weakly informative Gamma priors on the precision with parameters <code>0.01</code> and <code>0.01</code> (Gómez-Rubio, 2020).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Gamma priors for the precision of temporal random effects</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>prior_t <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">prec =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">'loggamma'</span>, <span class="at">param =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>))) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The spatial random effect is specified using the BYM2 model, which facilitates assigning Penalized Complexity (PC) priors to its hyperparameters (Simpson et al., 2017). These priors are conservative and weakly informative, thus allowing the data to drive the inclusion of spatial structure (Moraga, 2019).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define penalized complexity (PC) priors for spatial random effects using BYM2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>prior_sp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prec =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">'pc.prec'</span>, <span class="at">param =</span> <span class="fu">c</span>(<span class="fl">0.5</span> <span class="sc">/</span> <span class="fl">0.31</span>, <span class="fl">0.01</span>)),  <span class="co"># Precision of spatial effect</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">phi  =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">'pc'</span>, <span class="at">param =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>))              <span class="co"># Mixing parameter: structured vs unstructured</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="example-1-ghrmodel-helper-functions" class="level1">
<h1>Example 1: GHRmodel helper functions</h1>
<section id="model-development" class="level2">
<h2 class="anchored" data-anchor-id="model-development">1. Model development</h2>
<p>In this example we demonstrate how to use <strong>GHRmodel</strong> helper functions to streamline writing INLA-compatible formulas.</p>
<section id="select-variables" class="level3">
<h3 class="anchored" data-anchor-id="select-variables">Select variables</h3>
<p>Users can specify which variables from the data set to include as covariates using the <code>extract_names()</code> function.</p>
<p>Here we select lags 1 through 6 for <em>tmin</em> and <em>pdsi</em> as well as the <em>urban</em> (percentage of inhabitants living in urban areas) and <em>main_climate_f</em> (a factor defining the climate zone) variables.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract variable names matching the specified patterns</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>cov_names <span class="ot">&lt;-</span> <span class="fu">extract_names</span>(<span class="at">data =</span> data,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"tmin."</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"pdsi."</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"urban"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"main_climate_f"</span>))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: character vector of covariate names</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(cov_names)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  chr [1:14] "tmin.l1" "tmin.l2" "tmin.l3" "tmin.l4" "tmin.l5" "tmin.l6" "pdsi.l1" "pdsi.l2" "pdsi.l3" "pdsi.l4" "pdsi.l5" ...</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="linear-covariates" class="level3">
<h3 class="anchored" data-anchor-id="linear-covariates">Linear covariates</h3>
<p>The <code>cov_uni()</code> function returns a list where each element contains a single covariate. This structure is suitable for fitting separate univariable models.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate list of single linear covariate names</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>uni_cov_lin <span class="ot">&lt;-</span> <span class="fu">cov_uni</span>(<span class="at">covariates =</span> cov_names, <span class="co"># Input character vector of covariate names</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"pdsi.l"</span>,  <span class="co"># Select lagged pdsi and tmin from the vector of covariate names</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"tmin.l"</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: list of single linear covariate names</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(uni_cov_lin,<span class="dv">2</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l1"</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l2"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="non-linear-covariates" class="level3">
<h3 class="anchored" data-anchor-id="non-linear-covariates">Non-linear covariates</h3>
<p>To include nonlinear covariates in the model, the <code>cov_nl()</code> function generates nonlinear effect terms compatible with the INLA formula structure. The nonlinear transformation is defined using three main arguments that are passed into <code>inla.group()</code>, which bins data into groups (Gómez-Rubio, 2020):</p>
<ul>
<li><p>The type of nonlinear effect is controlled by the <code>model</code> argument, which supports <code>"rw1"</code> (random walk of order 1) or <code>"rw2"</code> (random walk of order 2), and defaults to <code>"rw2"</code>.</p></li>
<li><p>The <code>method</code> argument allows the user to specify how to discretize the linear covariate. Accepted values are <code>"cut"</code> (equal-width intervals) and <code>"quantile"</code> (equal-width intervals in the probability space). The default is <code>"quantile"</code>.</p></li>
<li><p>The <code>n</code> argument sets the number of basis points (breaks) used to approximate the nonlinear effect and defaults to 10.</p></li>
</ul>
<blockquote class="blockquote">
<p>💡 <strong>Tip</strong>: Choosing a low <code>n</code> will result in a smoother function (at the risk of underfitting) whereas a high <code>n</code> will lead into a more flexible function (at the risk of overfitting). Make sure to explore and plot your data and check goodness-of-fit metrics to get the best possible fit!</p>
</blockquote>
<blockquote class="blockquote">
<p>📝 <strong>Note</strong>: In addition to <code>cov_nl</code>, <strong>GHRmodel</strong> provides the <code>onebasis_inla()</code> function for nonlinear covariate transformations. This function supports natural splines (<code>"ns"</code>), B-splines (<code>"bs"</code>), polynomial (<code>"poly"</code>), and other options from <code>dlnm::onebasis()</code>. For more information about one-basis terms see the <em>Complex Covariate Structures in GHRmodel</em> vignette by typing <code>vignette("GHRmodel_covariates")</code>.</p>
</blockquote>
<p>Here we transform the 1- to 6-month lagged <em>tmin</em> and <em>pdsi</em> variables into nonlinear terms using a random walk of order 2 (default). We apply 10 breaks to discretize the covariates using <code>method = "quantile"</code>, which ensures each bin contains a similar number of observations. By setting <code>add = FALSE</code>, the resulting list only includes the transformed variables.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate list of single nonlinear covariate names</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>uni_cov_nl <span class="ot">&lt;-</span> <span class="fu">cov_nl</span>(<span class="at">covariates =</span> cov_names, </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">"quantile"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">model =</span> <span class="st">"rw2"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"pdsi"</span>, <span class="st">"tmin"</span>), </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">add =</span><span class="cn">FALSE</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: list of single nonlinear covariate names</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(uni_cov_nl,<span class="dv">2</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(tmin.l1, method='quantile', n=10), model='rw2')"</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(tmin.l2, method='quantile', n=10), model='rw2')"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="non-linear-covariates-replicated-by-group" class="level3">
<h3 class="anchored" data-anchor-id="non-linear-covariates-replicated-by-group">Non-linear covariates replicated by group</h3>
<p>If the user wants to replicate the structure of a nonlinear effect across another variable (e.g., administrative unit), the name of the replicating variable should be specified in the <code>replicate</code> argument in <code>cov_nl()</code>. Using this argument, a separate smooth (nonlinear) function will be fitted for each level of the grouping variable, allowing the model to estimate distinct nonlinear effects of the covariate for each group level.</p>
<p>Here we transform the 1- to 6-month lagged <em>pdsi</em> variables into nonlinear terms using a random walk of order 2 replicated by the <em>main_climate_f</em> variable. This allows the model to estimate distinct nonlinear effects of <em>pdsi</em> for each climate zone, rather than assuming a single, pooled effect across all zones. By setting <code>add = TRUE</code>, the resulting list includes both the original linear terms and their corresponding nonlinear versions.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate list of replicated nonlinear covariate names</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>uni_cov_nl_rep <span class="ot">&lt;-</span> <span class="fu">cov_nl</span>(<span class="at">covariates =</span> uni_cov_lin, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">method =</span> <span class="st">"quantile"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"pdsi"</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n =</span> <span class="dv">10</span>, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">replicate =</span> <span class="st">"main_climate_f"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: list of replicated nonlinear covariate names</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(uni_cov_nl_rep[<span class="dv">13</span><span class="sc">:</span><span class="dv">14</span>])</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(pdsi.l1, method='quantile', n=10), model='rw2', replicate=main_climate_f)"</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(pdsi.l2, method='quantile', n=10), model='rw2', replicate=main_climate_f)"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="covariates-for-multivariate-models" class="level3">
<h3 class="anchored" data-anchor-id="covariates-for-multivariate-models">Covariates for multivariate models</h3>
<p>The <code>cov_multi()</code> function takes a character vector or a list of character vectors (e.g., output from <code>cov_uni()</code> or <code>cov_nl()</code>) and generates all possible combinations. This is useful for constructing multivariable models where the user wishes to explore joint effects of different covariates.</p>
<p>Here we generate all two-way combinations of the nonlinear covariates containing “tmin” and “pdsi” listed in the <code>uni_cov_nl_rep</code> object where the lagged <em>pdsi</em> variables were transformed to nonlinear terms replicated by the <em>main_climate_f</em> variable while the lagged <em>tmin</em> variables remained linear. Therefore, the output of the <code>cov_multi()</code> is all possible combinations of replicated nonlinear lagged <em>pdsi</em> variables with linear lagged <em>tmin</em> variables:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of combined predictors, some non linear and replicated</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>multi_cov_nl_rep <span class="ot">&lt;-</span> <span class="fu">cov_multi</span>(<span class="at">covariates =</span> uni_cov_nl_rep, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">pattern =</span>  <span class="fu">c</span>(<span class="st">"pdsi"</span>,<span class="st">"tmin"</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: list of replicated nonlinear pdsi lagged terms combined with linear tmin lagged terms</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(multi_cov_nl_rep[<span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>])</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(pdsi.l1, method='quantile', n=10), model='rw2', replicate=main_climate_f)"</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] "tmin.l1"                                                                                     </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(INLA::inla.group(pdsi.l2, method='quantile', n=10), model='rw2', replicate=main_climate_f)"</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] "tmin.l1"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="add-a-covariate-to-all-covariate-lists" class="level3">
<h3 class="anchored" data-anchor-id="add-a-covariate-to-all-covariate-lists">Add a covariate to all covariate lists</h3>
<p>The <code>cov_add()</code> function appends one or more covariate names to each set of covariates in a list. This is useful for stepwise inclusion of covariates in models or to create lists with covariate combinations.</p>
<p>Here we want to add the covariate <em>urban</em> to combinations of linear lagged <em>tmin</em> and <em>pdsi</em> covariates:</p>
<p>First we generate a list of all combinations of the lagged linear <em>tmin</em> and <em>pdsi</em> covariates using <code>cov_multi()</code> :</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate list of combinations of linear covariate names</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>multi_cov_lin <span class="ot">&lt;-</span> <span class="fu">cov_multi</span>(<span class="at">covariates =</span> uni_cov_lin,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"pdsi"</span>,<span class="st">"tmin"</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">add =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: list of combinations of linear covariate names</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(multi_cov_lin,<span class="dv">2</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l1" "tmin.l1"</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l2" "tmin.l1"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then we add the term <em>urban</em> to each element of the bivariate covariate list using <code>cov_add()</code>, resulting in combinations of three covariates: lagged linear <em>tmin</em> and <em>pdsi</em> plus <em>urban</em>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add urban to each element of the bivariate covariate list </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>triple_cov_lin <span class="ot">&lt;-</span> <span class="fu">cov_add</span>(<span class="at">covariates =</span> multi_cov_lin,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">name =</span> <span class="st">"urban"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: list of combinations of 3 linear covariate names</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(triple_cov_lin,<span class="dv">2</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l1" "tmin.l1" "urban"  </span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l2" "tmin.l1" "urban"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="interacting-covariates" class="level3">
<h3 class="anchored" data-anchor-id="interacting-covariates">Interacting covariates</h3>
<p>Interaction terms capture the additional effect of two (or more) covariates acting together on the outcome, beyond their individual contributions. For example, a recent dengue modeling study in Barbados found that a three-way interaction among long-lag dry conditions (6-month SPI lagged by 5 months), mid-lag hot conditions (3-month temperature anomaly lagged by 3 months), and short-lag wet conditions (6-month SPI lagged by 1 month) best predicted outbreak risk (Fletcher et al., 2025). This result shows how drought, heat, and rainfall at different lags can cascade together, amplifying dengue outbreak likelihood.</p>
<p>The function <code>cov_interact</code> creates interaction terms between selected linear covariates. It takes as input a list of covariate combinations (like the output from <code>cov_multi()</code>) and returns interaction terms formatted for use in INLA formulas. If two variables or patterns are selected, it generates all two-way interactions. If three are selected, it generates all pairwise and three-way interactions. <strong>Currently GHRmodel only supports interactions between linear terms</strong>.</p>
<p>Here we generate all two-way and three-way interactions of lagged linear <em>tmin</em> and <em>pdsi</em> and <em>urban</em>.</p>
<p>We use the covariate list <em>triple_cov_lin</em> (created above using <code>cov_add()</code>) where each element consists of three linear covariates to produce two and three-way interactions</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of interacting linear predictors</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>interacting_cov <span class="ot">&lt;-</span> <span class="fu">cov_interact</span>(<span class="at">covariates =</span> triple_cov_lin,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"pdsi"</span>,<span class="st">"tmin"</span>, <span class="st">"urban"</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: list of interactions between linear pdsi terms and linear tmin terms</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(interacting_cov, <span class="dv">2</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l1"               "tmin.l1"               "urban"                 "pdsi.l1:tmin.l1"       "pdsi.l1:urban"        </span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6] "tmin.l1:urban"         "pdsi.l1:tmin.l1:urban"</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "pdsi.l2"               "tmin.l1"               "urban"                 "pdsi.l2:tmin.l1"       "pdsi.l2:urban"        </span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6] "tmin.l1:urban"         "pdsi.l2:tmin.l1:urban"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="varying-covariates" class="level3">
<h3 class="anchored" data-anchor-id="varying-covariates">Varying covariates</h3>
<p>The <code>cov_varying()</code> function generates spatially or temporally varying linear effect terms compatible with INLA formulas. It modifies covariate names to the INLA-compatible form <code>f(unit, covariate, model = "iid")</code>, where <code>unit</code> is the name of a grouping variable by which the covariate effect will vary (e.g., <em>spat_id</em> or <em>year_id</em>).</p>
<p>Here we use the <code>multi_cov_lin</code> object (created above) that contains combinations of lagged linear <em>tmin</em> and <em>pdsi</em> covariates. By setting <code>covariates = multi_cov_lin</code> and <code>pattern = "pdsi"</code> in the <code>cov_varying()</code> function, we modify only the lagged <em>pdsi</em> variables, to create varying <em>pdsi</em> effects (slopes) per climate zone (by the <em>main_climate_f</em> variable), while leaving the lagged <em>tmin</em> variables unchanged in linear form. The result is a set of covariate combinations pairing climate zone–specific lagged <em>pdsi</em> variables with linear lagged <em>tmin</em>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of varying univariable predictors</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>varying_cov <span class="ot">&lt;-</span> <span class="fu">cov_varying</span>(<span class="at">covariates =</span> multi_cov_lin,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"pdsi"</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">unit =</span> <span class="st">"main_climate_f"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: list of combinations of lagged pdsi varying by main_climate_f and linear tmin terms</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(varying_cov,<span class="dv">2</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(main_climate_f, pdsi.l1, model = 'iid', constr = FALSE)" "tmin.l1"                                                  </span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "f(main_climate_f, pdsi.l2, model = 'iid', constr = FALSE)" "tmin.l1"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="varying-vs.-replicated-effects-in-inla" class="level3">
<h3 class="anchored" data-anchor-id="varying-vs.-replicated-effects-in-inla">Varying vs.&nbsp;Replicated Effects in INLA</h3>
<p><strong>GHRmodel</strong> supports distinct methods to model group-level heterogeneity depending on whether the covariate is linear or nonlinear:</p>
<p><strong>Varying effects</strong> for linear covariates - use <code>cov_varying()</code> to produce <code>f(group, covariate, model = "iid")</code>: Different linear slopes across groups. Used when the effect (slope) of a linear covariate is different for each group, without assuming smoothness or shared structure. Think of it as a random slope model: each group gets its own coefficient for a covariate, and these are modeled as independent random effects.</p>
<p><strong>Replicated effects</strong> for nonlinear functions - use the <code>replicate</code> argument in <code>cov_nl()</code> to produce <code>f(INLA::inla.group(covariate,...), model= "rw2", replicate = group)</code>: Used when the same smooth (nonlinear) functional form (e.g.&nbsp;random walk order 2) is applied separately to different groups. Each level of the group gets its own smooth curve, but the curves share the same structure (e.g., same number of breaks and model), with separate coefficients. An example would be nonlinear functions of mean temperature that are independently repeated across climate zones.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">Varying Effect</th>
<th style="text-align: left;">Replicate Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Applied to</td>
<td style="text-align: left;">Linear terms</td>
<td style="text-align: left;">Nonlinear terms</td>
</tr>
<tr class="even">
<td style="text-align: left;">Purpose</td>
<td style="text-align: left;">Group-specific linear slopes</td>
<td style="text-align: left;">Group-specific nonlinear functions</td>
</tr>
<tr class="odd">
<td style="text-align: left;">INLA syntax</td>
<td style="text-align: left;"><code>f(group, covariate, model = 'iid')</code></td>
<td style="text-align: left;"><code>f(covariate, model = ..., replicate = group)</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Structure assumption</td>
<td style="text-align: left;">Unstructured (<code>iid</code>)</td>
<td style="text-align: left;">Same structure (e.g., <code>rw2</code>), different curves</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Example use</td>
<td style="text-align: left;">Region-specific slopes of the linear effect of rainfall</td>
<td style="text-align: left;">Region-specific nonlinear effect of rainfall</td>
</tr>
</tbody>
</table>
<p>Comparison of Replicate and Varying Effects in INLA</p>
</section>
<section id="write-inla-compatible-model-formulas" class="level3">
<h3 class="anchored" data-anchor-id="write-inla-compatible-model-formulas">Write INLA-compatible model formulas</h3>
<p>The <code>write_inla_formulas()</code> function simplifies the creation of multiple INLA models by automatically structuring fixed effects, random effects, and interactions.</p>
<ol type="1">
<li><strong>Define covariate combinations</strong></li>
</ol>
<p>Here we compile a list of covariate combinations previously generated using the <code>cov_*</code> family of functions. Each element in the list corresponds to a distinct model specification, enabling structured comparisons across modeling approaches.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a combined list of various transformations and combinations of pdsi.l1 </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>cov_list <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    uni_cov_lin[[<span class="dv">1</span>]],             <span class="co"># [1] pdsi.l1 (linear)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    uni_cov_nl_rep[[<span class="dv">13</span>]],         <span class="co"># [2] pdsi.l1 (nonlinear replicated by 'main_climate_f')</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    multi_cov_lin[[<span class="dv">1</span>]],           <span class="co"># [3] pdsi.l1 (linear) + tmin.l1 (linear)</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    triple_cov_lin[[<span class="dv">1</span>]],          <span class="co"># [4] pdsi.l1 (linear) + tmin.l1 (linear) + urban (linear)</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    multi_cov_nl_rep[[<span class="dv">7</span>]],        <span class="co"># [5] pdsi.l1 (nonlinear replicated by 'main_climate_f') + tmin.l1 (linear)</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    interacting_cov[[<span class="dv">1</span>]],         <span class="co"># [6] pdsi.l1, tmin.l1, urban (linear main effects + 2-way &amp; 3-way interactions) </span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    varying_cov[[<span class="dv">1</span>]]              <span class="co"># [7] pdsi.l1 (linear varying by 'main_climate_f') + tmin.l1 (linear)</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  ),  </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  uni_cov_nl[<span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>]                <span class="co"># [8–13] pdsi.l1 through pdsi.l6 (nonlinear) </span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="2" type="1">
<li><strong>Write model formulas from covariate list</strong></li>
</ol>
<p>Next, we transform this list of covariates into a vector of INLA-compatible formulas using the <code>write_inla_formulas()</code> function:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>formulas_cov_list <span class="ot">&lt;-</span> <span class="fu">write_inla_formulas</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"dengue_cases"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">covariates =</span> cov_list,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">re1 =</span> <span class="fu">list</span>(<span class="at">id =</span><span class="st">"month_id"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">model =</span><span class="st">"rw1"</span>, <span class="at">cyclic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">hyper =</span> <span class="st">"prior_t"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">replicate =</span> <span class="st">"spat_meso_id"</span> ),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">re2 =</span> <span class="fu">list</span>(<span class="at">id =</span> <span class="st">"year_id"</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">model =</span> <span class="st">"iid"</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">hyper =</span> <span class="st">"prior_t"</span>),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">re3 =</span> <span class="fu">list</span>(<span class="at">id =</span> <span class="st">"spat_id"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">model =</span> <span class="st">"bym2"</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">graph =</span> <span class="st">"g"</span>, </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">hyper =</span> <span class="st">"prior_sp"</span>),</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of INLA formula generated</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>formulas_cov_list[<span class="dv">1</span>]</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "dengue_cases ~ 1 + f(month_id, model = 'rw1', replicate = spat_meso_id, cyclic = TRUE, hyper = prior_t) + f(year_id, model = 'iid', hyper = prior_t) + f(spat_id, model = 'bym2', graph = g, hyper = prior_sp)"</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(formulas_cov_list)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "character"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="3" type="1">
<li><strong>Convert model formulas to a <code>GHRformulas</code> object</strong></li>
</ol>
<p>Finally, we use the <code>as_GHRformulas()</code> function to convert the output from <code>write_inla_formulas()</code> into a standardized <code>GHRformulas</code> object:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>formulas_cov_list_ghr <span class="ot">&lt;-</span> <span class="fu">as_GHRformulas</span>(<span class="at">formulas =</span> formulas_cov_list)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(formulas_cov_list_ghr)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "GHRformulas" "list"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="model-fitting" class="level2">
<h2 class="anchored" data-anchor-id="model-fitting">2. Model fitting</h2>
<p>To evaluate the performance of multiple covariate model specifications using INLA, we can pass a list of predefined formulas as a <code>GHRformulas</code> object to <code>fit_models()</code>. After fitting, goodness-of-fit metrics can be extracted as a data frame directly through the <code>GHRmodels$mod_gof</code> element.</p>
<p>This example demonstrates fitting a set of negative binomial models that include different combinations of covariates constructed using <strong>GHRmodel</strong> helper functions, with an offset term to account for population at risk.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>model_cov_list <span class="ot">&lt;-</span> <span class="fu">fit_models</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formulas =</span> formulas_cov_list_ghr,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"nbinomial"</span>,           <span class="co"># Negative binomial likelihood</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"mod"</span>,                   <span class="co"># Label prefix for each model</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="st">"population"</span>,          <span class="co"># Offset variable to account for population size</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">control_compute =</span> <span class="fu">list</span>(</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">config =</span> <span class="cn">FALSE</span>,               <span class="co"># Do not posterior predictive distribution</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">vcov =</span> <span class="cn">FALSE</span>                  <span class="co"># Do not return variance-covariance matrix</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">pb =</span> <span class="cn">TRUE</span>,                      <span class="co"># Display progress bar</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">nthreads =</span> <span class="dv">8</span>                    <span class="co"># Use 8 threads for parallel computation</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(model_cov_list)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>model_cov_list_gof <span class="ot">&lt;-</span> model_cov_list<span class="sc">$</span>mod_gof</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">3. Model evaluation</h2>
<p>This section explains how to interpret the estimated coefficients from the complex covariate structures created above, including:</p>
<ul>
<li><p><strong>Interaction effects</strong></p></li>
<li><p><strong>Varying effects</strong> for linear covariates</p></li>
<li><p><strong>Replicated effects</strong> for nonlinear functions</p></li>
</ul>
<p>Output plots return <code>ggplot2</code> or <code>cowplot</code> objects that can be further customized by the user.</p>
<p>For guidance on evaluating covariates fitted as linear or nonlinear terms, as well as other model assessment tools in the package, see the <em>GHRmodel_overview</em> vignette.</p>
<section id="interaction-effects" class="level3">
<h3 class="anchored" data-anchor-id="interaction-effects">Interaction effects</h3>
<p><code>plot_coef_lin()</code> can be used to evaluate interaction effects between linear covariates (the only interactions currently supported in <strong>GHRmodel</strong>).</p>
<p>In this plot we observe that there is no significant effect of two or three-way interactions between <em>tmin.l1</em>, <em>pdsi.l1</em> and <em>urban</em> on dengue cases.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot linear effects and their interactions</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coef_lin</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> model_cov_list,                      <span class="co"># A list of fitted INLA models</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="fu">c</span>(<span class="st">"mod2"</span>, <span class="st">"mod4"</span>, <span class="st">"mod5"</span>, <span class="st">"mod7"</span>),  <span class="co"># Select models with linear effects to be plotted</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Custom labels for variables (applied only to non-interacting fixed effects)</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_label =</span> <span class="fu">c</span>(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tmin.l1"</span> <span class="ot">=</span> <span class="st">"Min. temp lag 1"</span>,              <span class="co"># Rename 'tmin.l1' to a descriptive label</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pdsi.l1"</span> <span class="ot">=</span> <span class="st">"PDSI lag 1"</span>,                   <span class="co"># Rename 'pdsi.l1' to a descriptive label</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"urban"</span>   <span class="ot">=</span> <span class="st">"Prop. urban population"</span>        <span class="co"># Rename 'urban' to a descriptive label</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Effects of linear and interacting covariates"</span>  </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Title for the plot summarizing what is being visualized</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_covariates_files/figure-gfm/plot interactions-1.png" style="display: block; margin: auto;"></p>
</section>
<section id="varying-linear-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="varying-linear-coefficients">Varying linear coefficients</h3>
<p>The <code>plot_coef_varying()</code> function generates a forest plot that visualizes varying coefficients — often referred to as random slopes — from a fitted <code>GHRmodels</code> object. These varying coefficients reflect how the effect of a covariate differs across different groups (e.g., regions, time points, climate zones) and are structured as <code>f(group, covariate, model = "iid")</code> in INLA formulas. Users specify the model ID and the name of the varying coefficient (the covariate corresponding to <code>"group"</code> in the formula). Each estimate is plotted along the x-axis, while the corresponding group (often spatial or temporal) units are displayed along the y-axis. The function supports optional customization of unit labels, axis titles, color palettes, and plot title.</p>
<p>Here we show the four major Köppen-Geiger climate regimes, the letter code they were originally assigned in the data set (<em>main_climate</em>) and the numeric ID they were assigned during data processing (<em>main_climate_f</em>). The variable <em>main_climate_f</em> was used to specify the varying effect:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 19%">
<col style="width: 58%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">main_climate_f</th>
<th style="text-align: left;">main_climate</th>
<th style="text-align: left;">Climate Zone Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">AF</td>
<td style="text-align: left;">Tropical Rainforest Climate</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">AM</td>
<td style="text-align: left;">Tropical Monsoon Climate</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">AW</td>
<td style="text-align: left;">Tropical Savanna Climate with Dry Winter</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">CFA</td>
<td style="text-align: left;">Humid Subtropical Climate</td>
</tr>
</tbody>
</table>
<p>Main Köppen-Geiger Climate Regimes used in the varying coefficient analysis</p>
<p>This plot shows how a linear covariate (<em>pdsi.l1</em>) has different slopes (effects) depending on the climate zone. We observe that the 95% credible interval for the effect of PDSI at one month lag does not contain zero in humid subtropical climates.</p>
<p><a name="varying-pdsi-plot"></a></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot linear slopes varying by climate zone. </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coef_varying</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> model_cov_list, <span class="co"># A list of fitted INLA model objects</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="st">"mod8"</span>,  <span class="co"># Select the model with varying slopes</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"Blues"</span>,   <span class="co"># Color palette for the plot (from RColorBrewer)</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"main_climate_f"</span>, <span class="co"># The grouping variable (factor) </span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Effect of PDSI at one-month lag for each climate zone"</span>,  <span class="co"># Plot title</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Main climate zones"</span>,  <span class="co"># Label for the y-axis (groups/climate zones)</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit_label =</span> <span class="fu">c</span>( <span class="co"># Map factor levels to descriptive names </span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Tropical Rainforest Climate"</span>, </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Tropical Monsoon Climate"</span>, </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Tropical Savanna Climate with Dry Winter"</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Humid Subtropical Climate"</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_covariates_files/figure-gfm/Varying coefficients-1.png" width="100%" style="display: block; margin: auto;"></p>
</section>
<section id="replicated-nonlinear-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="replicated-nonlinear-coefficients">Replicated nonlinear coefficients</h3>
<p>nonlinear covariates replicated by group can be evaluated with the <code>plot_coef_nl()</code> function. Replicated effects can only be displayed in grid mode (<code>collapse = FALSE</code>), which produces one plot per covariate–model combination, with effects in columns and models in rows. If only one model is provided and both <code>name</code> and <code>pattern</code> are left NULL, all nonlinear effects will be plotted automatically. When multiple models are specified in the <code>mod_id</code> argument, the user must explicitly choose which nonlinear covariates to plot by providing either <code>name</code> or <code>pattern</code>.</p>
<p>Here we plot 2 models with replicated effects, the nonlinear term of PDSI at one-month lag replicated by climate zone, with and without an additional term for mean minimum temperature at one-month lag. We observe that the effect of wet conditions on dengue cases is strongest in regions <em>1</em> and <em>4</em>, that is Humid Subtropical Climate and Tropical Rainforest Climate, which aligns with the results obtained from structuring PDSI at 1 month lag as a linear effect with a varying slope by climate (<a href="#varying-pdsi-plot">see plot above</a>). The effects of <em>pdsi.l1</em> do not change when a temperature covariate is added.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PLot replicated nonlinear effects</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coef_nl</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> model_cov_list, <span class="co"># List of fitted INLA model objects</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_id =</span> <span class="fu">c</span>(<span class="st">"mod3"</span>, <span class="st">"mod6"</span>), <span class="co"># Select which models to include in the plot</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mod_label =</span> <span class="fu">c</span>( <span class="co"># Custom display labels for the selected models</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod3"</span> <span class="ot">=</span> <span class="st">"pdsi.l1_rep_clim"</span>,    </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mod6"</span> <span class="ot">=</span> <span class="st">"pdsi.l1_rep_clim + tmin.l1"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_label =</span> <span class="fu">c</span>( <span class="co"># Rename variables for clearer axis/legend labels</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pdsi.l1"</span> <span class="ot">=</span> <span class="st">"PDSI lag 1"</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"pdsi.l1"</span>, <span class="co"># Variable to plot: nonlinear effect of pdsi.l1</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Nonlinear effect of PDSI at one-month lag replicated by main climate"</span>, </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"PDSI"</span>, <span class="co"># X-axis label</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">"IDE2"</span>, <span class="co"># Color palette for plotting the nonlinear curves</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">collapse =</span> <span class="cn">FALSE</span>, <span class="co"># Display results in a grid (one plot per covariate-model pair)</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">rug =</span> <span class="cn">FALSE</span>,  <span class="co"># Do not show rug plot for data density along the x-axis</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">histogram =</span> <span class="cn">TRUE</span>, <span class="co"># Show histogram of covariate distribution instead of rug plot</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="st">"Climate zone"</span> <span class="co"># Add legend title</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_covariates_files/figure-gfm/plot_coef_nl grid replicated-1.png" width="100%" style="display: block; margin: auto;"></p>
<p><br></p>
</section>
</section>
</section>
<section id="example-2-inla-compatible-formulas" class="level1">
<h1>Example 2: INLA-compatible formulas</h1>
<p>In some cases, users may wish to define their own INLA-compatible model formulas manually rather than generating them through <strong>GHRmodel</strong> helper functions. This approach offers full flexibility over the model structure, particularly when specifying complex fixed and random effects. When constructing a custom set of models for comparison, it is recommended to place a baseline model (an intercept-only or random effect-only model) as the first entry in the list. This ensures compatibility with the automatic model comparison functionality in <code>fit_models()</code>, which uses the first model as the reference point for computing differences in goodness-of-fit metrics. In addition, all formulas are required to have the same random effect structure for compatibility with <code>as_GHRformulas()</code>.</p>
<section id="model-development-1" class="level2">
<h2 class="anchored" data-anchor-id="model-development-1">1. Model development</h2>
<p>Below, we provide a user-defined vector of INLA-compatible model formulas and convert it into a standardized <code>GHRformulas</code> object using the <code>as_GHRformulas()</code> function. This object can then be passed to the <code>fit_models()</code> function for model fitting.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert list of user-defined INLA formulas into a GHRformulas object </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>formulas_user_ghr <span class="ot">&lt;-</span> <span class="fu">as_GHRformulas</span>(<span class="fu">c</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Model 1: random effects only, where monthly random effect is replicated by meso region and the spatial random effect is replicated by year</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dengue_cases ~ 1 +</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="st">     f(month_id, model = 'rw1', replicate = spat_meso_id, cyclic = TRUE, constr = TRUE, hyper = prior_t) +</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="st">     f(year_id, model = 'iid', constr = TRUE, hyper = prior_t) +</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="st">     f(spat_id, model = 'bym2', graph = g, constr = TRUE, hyper = prior_sp, replicate = year_id2)"</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Model 2: random effects and a varying effect for pdsi lag 1 by climate zone</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dengue_cases ~ 1 + f(main_climate_f, pdsi.l1, model = 'iid') +</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="st">     f(month_id, model = 'rw1', replicate = spat_meso_id, cyclic = TRUE, constr = TRUE, hyper = prior_t) +</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="st">     f(year_id, model = 'iid', constr = TRUE, hyper = prior_t) +</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="st">     f(spat_id, model = 'bym2', graph = g, constr = TRUE, hyper = prior_sp, replicate = year_id2)"</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Model 3: random effects and a 3-way interaction between different pdsi and tmin lags</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dengue_cases ~ 1 + pdsi.l1 + tmin.l3 + pdsi.l6 + pdsi.l1:tmin.l3:pdsi.l6 +</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="st">     f(month_id, model = 'rw1', replicate = spat_meso_id, cyclic = TRUE, constr = TRUE, hyper = prior_t) +</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="st">     f(year_id, model = 'iid', constr = TRUE, hyper = prior_t) +</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="st">     f(spat_id, model = 'bym2', graph = g, constr = TRUE, hyper = prior_sp, replicate = year_id2)"</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize output: GHRformulas object</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(formulas_user_ghr)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "GHRformulas" "list"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="model-fitting-1" class="level2">
<h2 class="anchored" data-anchor-id="model-fitting-1">2. Model fitting</h2>
<p>Fit the user-defined model formulas:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># User-defined INLA-compatible formulas can be passed into fit_models() as a GHRformulas object</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>model_user <span class="ot">&lt;-</span> <span class="fu">fit_models</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formulas =</span> formulas_user_ghr,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"nbinomial"</span>,           <span class="co"># Negative binomial likelihood</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"mod"</span>,                   <span class="co"># Label prefix for each model</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="st">"population"</span>,          <span class="co"># Offset variable to account for population size</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">control_compute =</span> <span class="fu">list</span>(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">config =</span> <span class="cn">FALSE</span>,               <span class="co"># Do not posterior predictive distribution</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">vcov =</span> <span class="cn">FALSE</span>                  <span class="co"># Do not return variance-covariance matrix</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">pb =</span> <span class="cn">TRUE</span>,                      <span class="co"># Display progress bar</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">nthreads =</span> <span class="dv">8</span>                    <span class="co"># Use 8 threads for parallel computation</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="model-evaluation-1" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation-1">3. Model evaluation</h2>
<p>The <em>GHRmodel Overview</em> vignette describes the full set of functions available for model evaluation, which can be applied here to assess model performance.</p>
<p>For example we can evaluate the effect of the linear coefficients using <code>plot_coef_lin()</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot any linear coefficients found in the fitted model results. </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coef_lin</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> model_user,              <span class="co"># Provide fitted model GHRmodels object</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp =</span> <span class="cn">TRUE</span>,                      <span class="co"># Exponentiate coefficients to relative risk scale</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Relative Risk (RR)"</span>     <span class="co"># Plot title</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="GHRmodel_covariates_files/figure-gfm/plot user model-1.png" style="display: block; margin: auto;"></p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-fletcher_compound_2025" class="csl-entry" role="listitem">
Fletcher, C., Moirano, G., Alcayna, T., Rollock, L., Van Meerbeeck, C. J., Mahon, R., Trotman, A., Boodram, L.-L., Browne, T., Best, S., Lührsen, D., Diaz, A. R., Dunbar, W., Lippi, C. A., Ryan, S. J., Colón-González, F. J., Stewart-Ibarra, A. M., &amp; Lowe, R. (2025). Compound and cascading effects of climatic extremes on dengue outbreak risk in the Caribbean: An impact-based modelling framework with long-lag and short-lag interactions. <em>The Lancet Planetary Health</em>, <em>9</em>(8), 101279. <a href="https://doi.org/10.1016/j.lanplh.2025.06.003" class="uri">https://doi.org/10.1016/j.lanplh.2025.06.003</a>
</div>
<div id="ref-gomez-rubio_bayesian_2020" class="csl-entry" role="listitem">
Gómez-Rubio, V. (2020). <em>Bayesian inference with INLA</em>. Chapman &amp;Hall/CRC Press. <a href="https://becarioprecario.bitbucket.io/inla-gitbook/index.html" class="uri">https://becarioprecario.bitbucket.io/inla-gitbook/index.html</a>
</div>
<div id="ref-lindgren_explicit_2011" class="csl-entry" role="listitem">
Lindgren, F., Rue, H., &amp; Lindström, J. (2011). An Explicit Link between Gaussian Fields and Gaussian Markov Random Fields: The Stochastic Partial Differential Equation Approach. <em>Journal of the Royal Statistical Society Series B: Statistical Methodology</em>, <em>73</em>(4), 423–498. <a href="https://doi.org/10.1111/j.1467-9868.2011.00777.x" class="uri">https://doi.org/10.1111/j.1467-9868.2011.00777.x</a>
</div>
<div id="ref-moraga_geospatial_2019" class="csl-entry" role="listitem">
Moraga, P. (2019). <em>Geospatial Health Data: Modeling and Visualization with R-INLA and Shiny</em>. Chapman &amp; Hall/CRC Biostatistics Series. <a href="https://www.paulamoraga.com/book-geospatial/index.html" class="uri">https://www.paulamoraga.com/book-geospatial/index.html</a>
</div>
<div id="ref-simpson_penalising_2017" class="csl-entry" role="listitem">
Simpson, D., Rue, H., Riebler, A., Martins, T. G., &amp; Sørbye, S. H. (2017). Penalising Model Component Complexity: A Principled, Practical Approach to Constructing Priors. <em>Statistical Science</em>, <em>32</em>(1). <a href="https://doi.org/10.1214/16-STS576" class="uri">https://doi.org/10.1214/16-STS576</a>
</div>
</div>


</section>

</span></span></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/BSC-ES\.github\.io\/GHRtools\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, GHR</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>